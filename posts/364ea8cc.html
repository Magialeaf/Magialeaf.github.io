<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>设计模式 | Magialeaf的小窝</title><meta name="author" content="Maigaleaf"><meta name="copyright" content="Maigaleaf"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="设计模式知识">
<meta property="og:type" content="article">
<meta property="og:title" content="设计模式">
<meta property="og:url" content="http://magialeaf.github.io/posts/364ea8cc.html">
<meta property="og:site_name" content="Magialeaf的小窝">
<meta property="og:description" content="设计模式知识">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://magialeaf.github.io/img/default_cover_9.png">
<meta property="article:published_time" content="2023-10-11T04:00:00.000Z">
<meta property="article:modified_time" content="2024-04-24T05:23:45.297Z">
<meta property="article:author" content="Maigaleaf">
<meta property="article:tag" content="概述">
<meta property="article:tag" content="设计模式">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://magialeaf.github.io/img/default_cover_9.png"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="http://magialeaf.github.io/posts/364ea8cc.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"距离上次更新已经过去","messageNext":"天了，文章内容可能已经过期！"},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Maigaleaf","link":"链接: ","source":"来源: Magialeaf的小窝","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '设计模式',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-24 13:23:45'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/readPercent.css"><link rel="stylesheet" href="/css/announcement.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">79</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">59</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa-solid fa-bookmark"></i><span> 作品</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/works/"><i class="fa-fw fa-sharp fa-solid fa-star"></i><span> 作品集</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa-solid fa-comment"></i><span> 社区</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/default_cover_9.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Magialeaf的小窝"><span class="site-name">Magialeaf的小窝</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><!-- span=' '+_p('search.title')--></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa-solid fa-bookmark"></i><span> 作品</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/works/"><i class="fa-fw fa-sharp fa-solid fa-star"></i><span> 作品集</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa-solid fa-comment"></i><span> 社区</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">设计模式</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-11T04:00:00.000Z" title="发表于 2023-10-11 12:00:00">2023-10-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-04-24T05:23:45.297Z" title="更新于 2024-04-24 13:23:45">2024-04-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%BC%80%E5%8F%91%E7%9F%A5%E8%AF%86/">开发知识</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">20.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>87分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="设计模式"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><blockquote>
<p>下列语言的实现主要是<code>C#</code>语言</p>
<p>学习资料：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1zZ4y1u7mp?p=1&amp;vd_source=b9521fbd84454f03eb78189e6ea6f9e6">author::设计模式概述</a></p>
<p>资料作者：<a target="_blank" rel="noopener" href="https://github.com/ZShijun/DesignPattern">author::ZShijun/DesignPattern</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43122090/article/details/105462226">设计模式面试题（总结最全面的面试题！！！）-CSDN博客</a></p>
</blockquote>
<hr>
<h2 id="一、设计模式基础"><a href="#一、设计模式基础" class="headerlink" title="一、设计模式基础"></a>一、设计模式基础</h2><h3 id="1-面向对象"><a href="#1-面向对象" class="headerlink" title="1 面向对象"></a>1 面向对象</h3><blockquote>
<p>特性：封装、继承、多态。</p>
<p>目标：设计出高内聚、低耦合的应用程序，最大程度的实现程序的复用，以应对复杂的需求变化。</p>
<p>设计原则：单一职责原则、依赖倒置原则、开闭原则、接口隔离原则、里氏替换原则、合成复用原则、迪米特原则。</p>
</blockquote>
<h3 id="2-设计模式"><a href="#2-设计模式" class="headerlink" title="2 设计模式"></a>2 设计模式</h3><blockquote>
<p>模式就是对前人积累的经验的抽象和升华。简单地说，就是从不断重复出现的事件中发现和抽象出规律，并解决同一类问题的经验总结，在软件工程领域中的模式可分为三个层次。</p>
<p>层次：</p>
<ul>
<li>惯用法：最底层，语言相关，如引用计数，智能指针，垃圾收集等。</li>
<li>设计模式：中层，语言无关，如工厂模式，策略模式等。</li>
<li>架构模式：最高层，语言无关，用于高层决策，实现架构复用，如C/S架构，B/S架构，微服务架构等。</li>
</ul>
<p>GoF设计模式根据其目的可分为三种类型：</p>
<ul>
<li>创建型：主要用于创建对象，主要有工厂方法模式、抽象工厂模式、单例模式、建造者模式、原型模式。</li>
<li>结构型：主要用于处理类或对象的组合，主要有适配器模式、装饰器模式、代理模式、外观模式、桥接模式、组合模式、享元模式。</li>
<li>行为型：主要用于描述对类或对象之间的交互及职责分配，主要有策略模式、模板方法模式、观察者模式、迭代器模式、责任链模式、命令模式、备忘录模式、状态模式、访问者模式、中介者模式、解释器模式。</li>
</ul>
</blockquote>
<h3 id="3-七大设计原则"><a href="#3-七大设计原则" class="headerlink" title="3 七大设计原则"></a>3 七大设计原则</h3><blockquote>
<p>单一职责原则：一个类只负责一个功能领域中的相应职责。</p>
<p>依赖倒置原则：</p>
<ul>
<li>高层模块不应该依赖于低层模块，二者都应该依赖于抽象。</li>
<li>抽象类不应该依赖于细节类，细节类应当依赖于抽象类。</li>
<li>换言之，要面向接口（抽象类）编程，而不是面向实现编程。</li>
</ul>
<p>开闭原则：一个软件实体应当对扩展开放，对修改关闭。即软件实体应尽量在不修改原有代码的情况下进行扩展。</p>
<p>接口隔离原则：使用多个专门的接口，而不使用单一的总接口。</p>
<p>里氏替换原则：所有基类出现的地方必定能被子类替换，且功能不会发生影响。</p>
<p>合成复用原则：尽量使用对象组合/聚合，而不是继承来达到复用的目的：</p>
<ul>
<li>组合：在初始化以后，内部的属性值不可被替换。比如我创建了一个圆形画布后，就不可以修改了，这是圆形类和画布类组合在了一起。</li>
<li>聚合：初始化以后，内部的属性值依然可以被替换。比如我创建了一个圆形画布后，可以修改，将圆形画布换成方形，这叫聚合。现在一般都是聚合。</li>
</ul>
<p>迪米特原则：也叫最小知识原则，一个软件实体应当尽可能少地与其他实体发生相互作用。类与类之间的耦合度应尽量的低，这样如果类发生变化，影响才会最小。</p>
<p>开闭原则是目标，里氏代换原则是基础，依赖倒置原则是手段。</p>
<p>核心思想就是隔离变化，针对接口编程而不是针对实现编程。</p>
</blockquote>
<hr>
<h2 id="二、创建型"><a href="#二、创建型" class="headerlink" title="二、创建型"></a>二、创建型</h2><h3 id="1-工厂模式"><a href="#1-工厂模式" class="headerlink" title="1 工厂模式"></a>1 工厂模式</h3><h4 id="1-1-Factory概念"><a href="#1-1-Factory概念" class="headerlink" title="1.1 Factory概念"></a>1.1 Factory概念</h4><blockquote>
<p>工厂顾名思义就是创建产品，本质就是用工厂方法代替<code>new</code>操作创建一种实例化对象的方式。根据不同的实现方式和抽象级别又可分为简单工厂，工厂方法和抽象工厂三种模式。</p>
</blockquote>
<h4 id="1-2-简单工厂模式"><a href="#1-2-简单工厂模式" class="headerlink" title="1.2 简单工厂模式"></a>1.2 简单工厂模式</h4><blockquote>
<p>简单工厂又叫做静态工厂方法模式，但不属于23种GOF设计模式之一。简单工厂模式是由一个工厂对象决定创建出哪一种产品类的实例。</p>
<p>一般情况下使用较好，也有人认为简单工厂模式是一种反模式。</p>
<p>优点：</p>
<ul>
<li>实现了对责任的分割，隔离了变化，因为它提供了专门的工厂类用于创建对象。</li>
<li>通过配置文件，可以在不修改任何客户端代码的情况下更换和增加新的具体产品类，在一定程度上提高了系统的灵活性。</li>
</ul>
<p>缺点：</p>
<ul>
<li>集中了所有实例的创建逻辑，违反了单一职责原则。</li>
<li>扩展困难，一旦添加新产品就不得不修改工厂逻辑，违反了开闭原则。</li>
</ul>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 简单工厂类（设置了专门的类创建对象，但是这个类集中了所有实例的创建）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">DbConnectionFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 可以改成配置文件读取</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">string</span> _connectionString = <span class="string">@&quot;Server=(LocalDB)\MSSQLLocalDB; Integrated Security=true;Initial Catalog=FactoryDb&quot;</span>;</span><br><span class="line">    <span class="comment">// 可以改成配置文件读取</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">string</span> _dbType = <span class="string">&quot;Sqlserver&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DbConnection <span class="title">CreateDbConnection</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果要扩展，需要加源码，违反了开闭原则</span></span><br><span class="line">        <span class="keyword">if</span> (_dbType == <span class="string">&quot;Sqlserver&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SqlConnection(_connectionString);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (_dbType == <span class="string">&quot;MySql&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> MySqlConnection(_connectionString);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 被封装的类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SqlHelper</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 增删改操作，返回影响条数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">ExecuteNonQuery</span>(<span class="params"><span class="built_in">string</span> sql</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 创建数据库链接</span></span><br><span class="line">        <span class="keyword">using</span> (DbConnection conn = DbConnectionFactory.CreateDbConnection())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (DbCommand cmd = conn.CreateCommand())</span><br><span class="line">            &#123;</span><br><span class="line">                conn.Open();</span><br><span class="line">                cmd.CommandText = sql;</span><br><span class="line">                <span class="keyword">return</span> cmd.ExecuteNonQuery();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询操作，返回查询结果中的第一行第一列的值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">ExecuteScalar</span>(<span class="params"><span class="built_in">string</span> sql</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 创建数据库链接</span></span><br><span class="line">        <span class="keyword">using</span> (DbConnection conn = DbConnectionFactory.CreateDbConnection())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (DbCommand cmd = conn.CreateCommand())</span><br><span class="line">            &#123;</span><br><span class="line">                conn.Open();</span><br><span class="line">                cmd.CommandText = sql;</span><br><span class="line">                <span class="keyword">return</span> cmd.ExecuteScalar();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        SqlHelper sqlHelper = <span class="keyword">new</span> SqlHelper();</span><br><span class="line">        <span class="comment">//string insertSql = &quot;insert into [Users](Name,Age) values(&#x27;ww&#x27;,13);&quot;;</span></span><br><span class="line">        <span class="comment">//int res = sqlHelper.ExecuteNonQuery(insertSql);</span></span><br><span class="line">        <span class="comment">//Console.WriteLine($&quot;插入&#123;res&#125;记录&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">string</span> selectSql = <span class="string">&quot;select count(*) from [Users];&quot;</span>;</span><br><span class="line">        <span class="built_in">object</span> count = sqlHelper.ExecuteScalar(selectSql);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;共有<span class="subst">&#123;count&#125;</span>记录&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 利用反射实现的简单工厂</span></span><br><span class="line"><span class="comment">// 定义接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title">IProduct</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ShowInfo</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品类实现接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">ConcreteProductA</span> : <span class="title">IProduct</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowInfo</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;This is Concrete Product A.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title">ConcreteProductB</span> : <span class="title">IProduct</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowInfo</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;This is Concrete Product B.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简单工厂类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">SimpleFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IProduct <span class="title">CreateProduct</span>(<span class="params"><span class="built_in">string</span> productName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Type type = Type.GetType(productName);</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="literal">null</span> || !<span class="keyword">typeof</span>(IProduct).IsAssignableFrom(type))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentException(<span class="string">&quot;Invalid product name.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Activator.CreateInstance(type) <span class="keyword">as</span> IProduct;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        SimpleFactory factory = <span class="keyword">new</span> SimpleFactory();</span><br><span class="line"></span><br><span class="line">        IProduct productA = factory.CreateProduct(<span class="string">&quot;ConcreteProductA&quot;</span>);</span><br><span class="line">        productA.ShowInfo();</span><br><span class="line"></span><br><span class="line">        IProduct productB = factory.CreateProduct(<span class="string">&quot;ConcreteProductB&quot;</span>);</span><br><span class="line">        productB.ShowInfo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-工厂方法模式"><a href="#1-3-工厂方法模式" class="headerlink" title="1.3 工厂方法模式"></a>1.3 工厂方法模式</h4><blockquote>
<p>定义一个工厂父类，工厂父类负责定义创建对象的公共接口，而子类则负责生成具体的对象。即将类的实例化延迟到工厂类的子类中完成，即由子类来决定应该实例化哪一个类。</p>
<p>优点：符合设计原则。</p>
<p>缺点：类的个数成倍增加，增加了系统的复杂度。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Mysql数据库类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MySqlConnectionFactory</span> : <span class="title">DbConnectionFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">string</span> _connectionString = <span class="string">@&quot;...&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> DbConnection <span class="title">CreateDbConnection</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MySqlConnection(_connectionString);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Oracle数据库类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OracleSqlConnectionFactory</span> : <span class="title">DbConnectionFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">string</span> _connectionString = <span class="string">@&quot;...&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> DbConnection <span class="title">CreateDbConnection</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象出来的工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SqlConnectionFactory</span> : <span class="title">DbConnectionFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">string</span> _connectionString = <span class="string">@&quot;Server=(LocalDB)\MSSQLLocalDB; Integrated Security=true;Initial Catalog=FactoryDb&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> DbConnection <span class="title">CreateDbConnection</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SqlConnection(_connectionString);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 被封装的类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SqlHelper</span></span><br><span class="line">&#123;</span><br><span class="line">    DbConnectionFactory _connectionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过传递一个数据库类来表明新建的数据库是哪种数据库</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SqlHelper</span>(<span class="params">DbConnectionFactory connectionFactory</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>._connectionFactory = connectionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 增删改操作，返回影响条数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">ExecuteNonQuery</span>(<span class="params"><span class="built_in">string</span> sql</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> (DbConnection conn = _connectionFactory.CreateDbConnection())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (DbCommand cmd = conn.CreateCommand())</span><br><span class="line">            &#123;</span><br><span class="line">                conn.Open();</span><br><span class="line">                cmd.CommandText = sql;</span><br><span class="line">                <span class="keyword">return</span> cmd.ExecuteNonQuery();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询操作，返回查询结果中的第一行第一列的值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">ExecuteScalar</span>(<span class="params"><span class="built_in">string</span> sql</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> (DbConnection conn = _connectionFactory.CreateDbConnection())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (DbCommand cmd = conn.CreateCommand())</span><br><span class="line">            &#123;</span><br><span class="line">                conn.Open();</span><br><span class="line">                cmd.CommandText = sql;</span><br><span class="line">                <span class="keyword">return</span> cmd.ExecuteScalar();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        SqlHelper sqlHelper = <span class="keyword">new</span> SqlHelper(<span class="keyword">new</span> SqlConnectionFactory());</span><br><span class="line">        <span class="comment">//string insertSql = &quot;insert into [Users](Name,Age) values(&#x27;ww&#x27;,13);&quot;;</span></span><br><span class="line">        <span class="comment">//int res = sqlHelper.ExecuteNonQuery(insertSql);</span></span><br><span class="line">        <span class="comment">//Console.WriteLine($&quot;插入&#123;res&#125;记录&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">string</span> selectSql = <span class="string">&quot;select count(*) from [Users];&quot;</span>;</span><br><span class="line">        <span class="built_in">object</span> count = sqlHelper.ExecuteScalar(selectSql);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;共有<span class="subst">&#123;count&#125;</span>记录&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-4-抽象工厂模式"><a href="#1-4-抽象工厂模式" class="headerlink" title="1.4 抽象工厂模式"></a>1.4 抽象工厂模式</h4><blockquote>
<p>抽象工厂是工厂方法的升级版，为相关或者相互依赖的对象提供一个统一的接口，而且无需指定他们的具体实现类。</p>
<p>比如我要对在工厂方法中扩展对sql参数的自定义，那么我需要再添加参数工厂类，Mysql参数类，Oracle参数类等，这样会产生非常多的类。</p>
<p>因此工厂方法模式的问题：</p>
<ul>
<li>类的数量成倍增长。</li>
<li>无法保证类之间的依赖关系。</li>
</ul>
<p>抽象工厂的特点：</p>
<ul>
<li><p>优点：对产品族进行约束，封装性好。</p>
</li>
<li><p>缺点：产品族扩展困难，添加一个产品需要修改抽象和具体工厂类，违背开闭原则。</p>
</li>
</ul>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 具体的sql类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SqlDbFactory</span> : <span class="title">DbFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">string</span> _connectionString = <span class="string">@&quot;Server=(LocalDB)\MSSQLLocalDB; Integrated Security=true;Initial Catalog=FactoryDb&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> DbConnection <span class="title">CreateDbConnection</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SqlConnection(_connectionString);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> DbParameter <span class="title">CreateDbParameter</span>(<span class="params"><span class="built_in">string</span> parameterName, <span class="built_in">object</span> <span class="keyword">value</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SqlParameter(parameterName, <span class="keyword">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象出来的工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">DbFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> DbConnection <span class="title">CreateDbConnection</span>()</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> DbParameter <span class="title">CreateDbParameter</span>(<span class="params"><span class="built_in">string</span> parameterName, <span class="built_in">object</span> <span class="keyword">value</span></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 被封装的类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SqlHelper</span></span><br><span class="line">&#123;</span><br><span class="line">    DbFactory _dbFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SqlHelper</span>(<span class="params">DbFactory dbFactory</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _dbFactory = dbFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 增删改操作，返回影响条数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">ExecuteNonQuery</span>(<span class="params"><span class="built_in">string</span> sql,<span class="keyword">params</span> DbParameter[] parms</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> (DbConnection conn = _dbFactory.CreateDbConnection())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (DbCommand cmd = conn.CreateCommand())</span><br><span class="line">            &#123;</span><br><span class="line">                conn.Open();</span><br><span class="line">                cmd.CommandText = sql;</span><br><span class="line">                <span class="keyword">if</span> (parms != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    cmd.Parameters.AddRange(parms);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> cmd.ExecuteNonQuery();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询操作，返回查询结果中的第一行第一列的值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">ExecuteScalar</span>(<span class="params"><span class="built_in">string</span> sql, <span class="keyword">params</span> DbParameter[] parms</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> (DbConnection conn = _dbFactory.CreateDbConnection())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (DbCommand cmd = conn.CreateCommand())</span><br><span class="line">            &#123;</span><br><span class="line">                conn.Open();</span><br><span class="line">                cmd.CommandText = sql;</span><br><span class="line">                <span class="keyword">if</span> (parms != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    cmd.Parameters.AddRange(parms);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> cmd.ExecuteScalar();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设定查询参数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DbParameter <span class="title">CreateDbParameter</span>(<span class="params"><span class="built_in">string</span> parameterName, <span class="built_in">object</span> <span class="keyword">value</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> _dbFactory.CreateDbParameter(parameterName, <span class="keyword">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        DbFactory dbFactory = <span class="keyword">new</span> SqlDbFactory();</span><br><span class="line">        SqlHelper sqlHelper = <span class="keyword">new</span> SqlHelper(dbFactory);</span><br><span class="line">        <span class="built_in">int</span> age = <span class="number">12</span>;</span><br><span class="line">        <span class="built_in">string</span> selectSql = <span class="string">$&quot;select count(*) from [Users] where Age&gt;@Age;&quot;</span>;</span><br><span class="line">        <span class="built_in">object</span> count = sqlHelper.ExecuteScalar(selectSql,</span><br><span class="line">                                               <span class="keyword">new</span> DbParameter[] &#123; sqlHelper.CreateDbParameter(<span class="string">&quot;@Age&quot;</span>, age) &#125;);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;共有<span class="subst">&#123;count&#125;</span>记录&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-单例模式"><a href="#2-单例模式" class="headerlink" title="2 单例模式"></a>2 单例模式</h3><h4 id="2-1-Singleton概念"><a href="#2-1-Singleton概念" class="headerlink" title="2.1 Singleton概念"></a>2.1 Singleton概念</h4><blockquote>
<p>保证一个类仅有一个实例，并提供一个访问它的全局访问点。</p>
<p>目的：</p>
<ul>
<li>全局唯一。</li>
<li>全局共享。</li>
</ul>
<p>优点：</p>
<ul>
<li>确保全局共享同一个实例。</li>
<li>节约系统资源。</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 会引发问题的单例模式</span></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>:</span><br><span class="line">    instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> cls.instance:</span><br><span class="line">            <span class="keyword">return</span> cls.instance</span><br><span class="line">        cls.instance = <span class="built_in">object</span>.__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls.instance</span><br><span class="line"></span><br><span class="line">obj1 = Singleton(<span class="string">&#x27;Alex&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(obj1)</span><br><span class="line"></span><br><span class="line">obj2 = Singleton(<span class="string">&#x27;Bob&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(obj2)</span><br></pre></td></tr></table></figure>
<h4 id="2-2-静态类实现"><a href="#2-2-静态类实现" class="headerlink" title="2.2 静态类实现"></a>2.2 静态类实现</h4><blockquote>
<p>直接设置一个静态类，不是单例模式，但可以满足需求，常用，可用于生产。</p>
<p>注意：这里的<code>++_counter</code>其实存在高并发问题，严格上应该用<code>Interlocked.Increment(ref _counter)</code>的方式。</p>
<p>优点：使用起来方便，简单。</p>
<p>缺点：</p>
<ul>
<li>静态类不能继承类，实现接口，不能通过接口或者抽象方法(虚方法)实现多态。</li>
<li>静态类必须在第一次加载时初始化，如果项目中用不到会导致资源浪费。（资源消耗较小的话，可以适当忽略）</li>
</ul>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 单例类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">SingletonSample1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> _counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">IncreaseCount</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> ++_counter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 高并发处理后的单例类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">SingletonSample1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> _counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">IncreaseCount</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Interlocked.Increment(<span class="keyword">ref</span> _counter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> count1 = singletonSample1.IncreaseCount();</span><br><span class="line">        <span class="built_in">int</span> count2 = SingletonSample1.IncreaseCount();</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;count1=<span class="subst">&#123;count1&#125;</span>,count2=<span class="subst">&#123;count2&#125;</span>&quot;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-内部初始化"><a href="#2-3-内部初始化" class="headerlink" title="2.3 内部初始化"></a>2.3 内部初始化</h4><blockquote>
<p>在内部进行静态初始化，可用于生产。</p>
<p>优点：解决了静态类不能继承类，实现接口，不能通过接口或者抽象方法(虚方法)实现多态的问题。</p>
<p>缺点：没有解决第一次加载时初始化，资源浪费的问题。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 单例类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">SingletonSample2</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 第一次自己内部进行初始化</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> SingletonSample2 _instance = <span class="keyword">new</span> SingletonSample2();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> _counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonSample2</span>()</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 外部通过此处进行调用</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingletonSample2 Instance</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> _instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">IncreaseCount</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> ++_counter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> count1 = singletonSample2.Instance.IncreaseCount();</span><br><span class="line">        <span class="built_in">int</span> count2 = SingletonSample2.Instance.IncreaseCount();</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;count1=<span class="subst">&#123;count1&#125;</span>,count2=<span class="subst">&#123;count2&#125;</span>&quot;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-4-过渡类"><a href="#2-4-过渡类" class="headerlink" title="2.4 过渡类"></a>2.4 过渡类</h4><blockquote>
<p>过渡阶段，不可用于生产。</p>
<p>SingletonSample3，加if判断：</p>
<ul>
<li><p>优点：解决了资源浪费的问题。</p>
</li>
<li><p>缺点：引入了高并发的新问题，高并发状态下可能会创建多个对象。可以用系统预热简单解决，但依然不建议使用。</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/70597595">没有预热，这不叫高并发，叫并发高 - 知乎 (zhihu.com)</a></p>
<p>SingletonSample4，加锁：</p>
<ul>
<li><p>优点：解决了高并发问题。</p>
</li>
<li><p>缺点：引入了性能问题。</p>
</li>
</ul>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 单例类3</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SingletonSample3</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingletonSample3 _instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> _counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonSample3</span>()</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingletonSample3 Instance</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 高并发状态下可能会多次new</span></span><br><span class="line">            <span class="keyword">if</span> (_instance == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                _instance = <span class="keyword">new</span> SingletonSample3();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> _instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">IncreaseCount</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> ++_counter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单例类4</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SingletonSample4</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingletonSample4 _instance;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">object</span> _locker = <span class="keyword">new</span> <span class="built_in">object</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> _counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonSample4</span>()</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingletonSample4 Instance</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 加锁系统资源开销大</span></span><br><span class="line">            <span class="keyword">lock</span> (_locker)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (_instance == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    _instance = <span class="keyword">new</span> SingletonSample4();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> _instance;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">IncreaseCount</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> ++_counter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> count1 = singletonSample3.Instance.IncreaseCount();</span><br><span class="line">        <span class="built_in">int</span> count2 = SingletonSample3.Instance.IncreaseCount();</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;count1=<span class="subst">&#123;count1&#125;</span>,count2=<span class="subst">&#123;count2&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">        count1 = singletonSample4.Instance.IncreaseCount();</span><br><span class="line">        count2 = SingletonSample4.Instance.IncreaseCount();</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;count1=<span class="subst">&#123;count1&#125;</span>,count2=<span class="subst">&#123;count2&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-5-双检锁实现"><a href="#2-5-双检锁实现" class="headerlink" title="2.5 双检锁实现"></a>2.5 双检锁实现</h4><blockquote>
<p>if套lock，设置双重锁,，可用于生产。</p>
<p>优点：解决了上述实现方式的各种设计缺陷。</p>
<p>缺点：代码有点复杂。</p>
<p>注：<code>C#</code>中依然有些问题。因为<code>_instance = new SingletonSample5();</code>并不是一步完成的。通常情况下，这一步是先开辟空间，再赋值，再将<code>_instance</code>指向这一段空间。而有些编译器会将该步骤优化成先开辟空间，然后就将<code>_instance</code>指向这一段空间，最后赋值。因此会导致这段空间还没被赋值，<code>_instance</code>就已经指向此处了。若此时还有新的请求到达，那么将会直接返回空的<code>_instance</code>，这是存在问题的。解决方法就是在<code>_instance</code>前加上<code>volatile</code>关键字。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 单例类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SingletonSample5</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 需要加上volatile关键字使编译器不进行优化来解决BUG</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> SingletonSample5 _instance;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">object</span> _locker = <span class="keyword">new</span> <span class="built_in">object</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> _counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonSample5</span>()</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingletonSample5 Instance</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 双重锁嵌套</span></span><br><span class="line">            <span class="keyword">if</span> (_instance == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">lock</span> (_locker)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (_instance == <span class="literal">null</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        _instance = <span class="keyword">new</span> SingletonSample5();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> _instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">IncreaseCount</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> ++_counter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> count1 = singletonSample5.Instance.IncreaseCount();</span><br><span class="line">        <span class="built_in">int</span> count2 = SingletonSample5.Instance.IncreaseCount();</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;count1=<span class="subst">&#123;count1&#125;</span>,count2=<span class="subst">&#123;count2&#125;</span>&quot;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-6-懒加载模式"><a href="#2-6-懒加载模式" class="headerlink" title="2.6 懒加载模式"></a>2.6 懒加载模式</h4><blockquote>
<p><code>.Net</code>支持的一种优雅版本的实现方式，<strong>强烈建议使用该版本</strong>。类似内部初始化方式。</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/346101917">如何使用 C# 中的 Lazy - 知乎 (zhihu.com)</a></p>
<p>Lazy：将对象的创建延迟到第一次需要使用时。</p>
<p>优点：代码优雅简洁同时满足需求。</p>
<p>缺点：当系统中有大量单例模式时，会有较多重复代码。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 单例类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SingletonSample6</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Lazy&lt;SingletonSample6&gt; _instance</span><br><span class="line">        = <span class="keyword">new</span> Lazy&lt;SingletonSample6&gt;(() =&gt; <span class="keyword">new</span> SingletonSample6());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> _counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonSample6</span>()</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingletonSample6 Instance</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> _instance.Value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">IncreaseCount</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> ++_counter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> count1 = singletonSample6.Instance.IncreaseCount();</span><br><span class="line">        <span class="built_in">int</span> count2 = SingletonSample6.Instance.IncreaseCount();</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;count1=<span class="subst">&#123;count1&#125;</span>,count2=<span class="subst">&#123;count2&#125;</span>&quot;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-7-懒加载泛型"><a href="#2-7-懒加载泛型" class="headerlink" title="2.7 懒加载泛型"></a>2.7 懒加载泛型</h4><blockquote>
<p>将懒加载需要重复写的代码封装了起来，拥有多个单例类时建议使用此版本。</p>
<p>优点：封装了重复代码。</p>
<p>缺点：违反了依赖倒置原则。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 泛型类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SingletonSampleBase</span>&lt;<span class="title">TSingleton</span>&gt; <span class="keyword">where</span> <span class="title">TSingleton</span>: <span class="keyword">class</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 利用反射创建，此处是一种反模式，相当于在类内部实例化。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Lazy&lt;TSingleton&gt; _instance</span><br><span class="line">        = <span class="keyword">new</span> Lazy&lt;TSingleton&gt;(() =&gt; (TSingleton)Activator.CreateInstance(<span class="keyword">typeof</span>(TSingleton), <span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不能在外部创建，所以用protected，可以被继承但不能在外部被创建</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">SingletonSampleBase</span>()</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TSingleton Instance</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> _instance.Value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SingletonSample7</span> : <span class="title">SingletonSampleBase</span>&lt;<span class="title">SingletonSample7</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> _counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonSample7</span>()</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">IncreaseCount</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> ++_counter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> count1 = singletonSample7.Instance.IncreaseCount();</span><br><span class="line">        <span class="built_in">int</span> count2 = SingletonSample7.Instance.IncreaseCount();</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;count1=<span class="subst">&#123;count1&#125;</span>,count2=<span class="subst">&#123;count2&#125;</span>&quot;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-8-单例案例"><a href="#2-8-单例案例" class="headerlink" title="2.8 单例案例"></a>2.8 单例案例</h4><blockquote>
<p>数据库单例案例，实际中不要用单例做对数据库的操作。</p>
<p>实际不使用的原因：</p>
<ul>
<li><p>线程安全性： 使用单例模式会引入全局共享的对象实例，可能存在多线程并发访问时的安全性问题，需要额外考虑线程安全措施。而每次操作数据库时都创建一个新的数据库连接或者使用连接池，可以更好地控制线程安全性。</p>
</li>
<li><p>资源消耗： 单例模式会在应用程序启动时就创建对象实例并一直存在于内存中，占用资源较多。而数据库连接需要进行资源管理，及时释放连接资源可以更好地避免资源耗尽的问题。</p>
</li>
<li><p>灵活性：每次操作数据库时可以根据需要灵活地创建新的数据库连接或者使用现有连接，而不受单例对象的限制，更适合在需要时动态创建和释放资源。</p>
</li>
</ul>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Mysql数据库</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MySqlHelper</span> : <span class="title">SqlHelperBase</span>&lt;<span class="title">MySqlHelper</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">string</span> _connectionString = <span class="string">@&quot;...&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MySqlHelper</span>()</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> DbConnection <span class="title">CreateDbConnection</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MySqlConnection(_connectionString);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> DbParameter <span class="title">CreateDbParameter</span>(<span class="params"><span class="built_in">string</span> parameterName, <span class="built_in">object</span> <span class="keyword">value</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MySqlParameter(parameterName, <span class="keyword">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据库接口（连接不同数据库）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISqlHelper</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="built_in">int</span> <span class="title">ExecuteNonQuery</span>(<span class="params"><span class="built_in">string</span> sql</span>)</span>;</span><br><span class="line">    <span class="function"><span class="built_in">object</span> <span class="title">ExecuteScalar</span>(<span class="params"><span class="built_in">string</span> sql</span>)</span>;</span><br><span class="line">    <span class="function">DbConnection <span class="title">CreateDbConnection</span>()</span>;</span><br><span class="line">    <span class="function">DbParameter <span class="title">CreateDbParameter</span>(<span class="params"><span class="built_in">string</span> parameterName, <span class="built_in">object</span> <span class="keyword">value</span></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体类（懒加载实现）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SqlHelper</span> : <span class="title">SqlHelperBase</span>&lt;<span class="title">SqlHelper</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">string</span> _connectionString = <span class="string">@&quot;Server=(LocalDB)\MSSQLLocalDB; Integrated Security=true;Initial Catalog=FactoryDb&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SqlHelper</span>()</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> DbConnection <span class="title">CreateDbConnection</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SqlConnection(_connectionString);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> DbParameter <span class="title">CreateDbParameter</span>(<span class="params"><span class="built_in">string</span> parameterName, <span class="built_in">object</span> <span class="keyword">value</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SqlParameter(parameterName, <span class="keyword">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 泛型类（懒加载泛型）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">SqlHelperBase</span>&lt;<span class="title">TSingleton</span>&gt;: <span class="title">ISqlHelper</span> <span class="keyword">where</span> <span class="title">TSingleton</span> : <span class="keyword">class</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Lazy&lt;TSingleton&gt; _instance = <span class="keyword">new</span> Lazy&lt;TSingleton&gt;(() =&gt; (TSingleton)Activator.CreateInstance(<span class="keyword">typeof</span>(TSingleton), <span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TSingleton Instance</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> _instance.Value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 增删改操作，返回影响条数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">ExecuteNonQuery</span>(<span class="params"><span class="built_in">string</span> sql</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> (DbConnection conn = CreateDbConnection())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (DbCommand cmd = conn.CreateCommand())</span><br><span class="line">            &#123;</span><br><span class="line">                conn.Open();</span><br><span class="line">                cmd.CommandText = sql;</span><br><span class="line">                <span class="keyword">return</span> cmd.ExecuteNonQuery();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询操作，返回查询结果中的第一行第一列的值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">ExecuteScalar</span>(<span class="params"><span class="built_in">string</span> sql</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> (DbConnection conn = CreateDbConnection())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (DbCommand cmd = conn.CreateCommand())</span><br><span class="line">            &#123;</span><br><span class="line">                conn.Open();</span><br><span class="line">                cmd.CommandText = sql;</span><br><span class="line">                <span class="keyword">return</span> cmd.ExecuteScalar();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> DbConnection <span class="title">CreateDbConnection</span>()</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> DbParameter <span class="title">CreateDbParameter</span>(<span class="params"><span class="built_in">string</span> parameterName, <span class="built_in">object</span> <span class="keyword">value</span></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        ISqlHelper sqlHelper = MySqlHelper.Instance;</span><br><span class="line">        <span class="comment">//string insertSql = &quot;insert into [Users](Name,Age) values(&#x27;ww&#x27;,13);&quot;;</span></span><br><span class="line">        <span class="comment">//int res = sqlHelper.ExecuteNonQuery(insertSql);</span></span><br><span class="line">        <span class="comment">//Console.WriteLine($&quot;插入&#123;res&#125;记录&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">string</span> selectSql = <span class="string">&quot;select count(*) from [Users];&quot;</span>;</span><br><span class="line">        <span class="built_in">object</span> count = sqlHelper.ExecuteScalar(selectSql);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;共有<span class="subst">&#123;count&#125;</span>记录&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-建筑者模式"><a href="#3-建筑者模式" class="headerlink" title="3 建筑者模式"></a>3 建筑者模式</h3><h4 id="3-1-Builder概念"><a href="#3-1-Builder概念" class="headerlink" title="3.1 Builder概念"></a>3.1 Builder概念</h4><blockquote>
<p>定义：建造者模式是将一个复杂的对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。创建者模式隐藏了复杂对象的创建过程，它把复杂对象的创建过程加以抽象，通过子类继承或者重载的方式，动态的创建复杂的、具有复合属性的对象。</p>
<p>角色：</p>
<ul>
<li>建造者（Builder）：不同种类的工人，如打地基的，建房梁的，室内装修的等。</li>
<li>具体的建造者（ConcreteBuilder）：每个工种对应的具体的工人。</li>
<li>指挥者（Director）：工程队总指挥，包工头，指挥具体的建造者建房子。</li>
<li>具体产品（Product）：最终建成的房子。</li>
</ul>
</blockquote>
<h4 id="3-2-最简单建筑者"><a href="#3-2-最简单建筑者" class="headerlink" title="3.2 最简单建筑者"></a>3.2 最简单建筑者</h4><blockquote>
<p>设置好主要对象和对象属性，自己进行组装。</p>
<p>优点：简单，并且配置可灵活搭配。</p>
<p>缺点：面向了实现编程，用户需要知道太多的创建细节。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 设置Cpu和具体Cpu（对象属性）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Cpu</span> &#123; <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">string</span> Type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HighCpu</span>:<span class="title">Cpu</span> &#123; <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = <span class="string">&quot;6核12线程&quot;</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LowCpu</span>:<span class="title">Cpu</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置内存和具体内存（对象属性）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Mem</span> &#123; <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">string</span> Type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HighCpu</span>:<span class="title">Mem</span> &#123; ... &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LowCpu</span>:<span class="title">Mem</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置屏幕和具体屏幕（对象属性）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Screen</span> &#123; <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">string</span> Type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HighCpu</span>:<span class="title">Screen</span> &#123; ... &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LowCpu</span>:<span class="title">Screen</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 手机（主要对象）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Phone</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Cpu Cpu &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Screen Screen &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mem Mem &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Show</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;手机配置:&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;CPU:<span class="subst">&#123;Cpu?.Type&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;内存:<span class="subst">&#123;Mem?.Type&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;屏幕:<span class="subst">&#123;Screen?.Type&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Phone highPhone = <span class="keyword">new</span> Phone();</span><br><span class="line">        highPhone.Cpu = <span class="keyword">new</span> HighCpu();</span><br><span class="line">        highPhone.Mem = <span class="keyword">new</span> HighMem();</span><br><span class="line">        highPhone.Screen = <span class="keyword">new</span> HighScreen();</span><br><span class="line">        highPhone.Show();</span><br><span class="line">        Console.WriteLine();</span><br><span class="line"></span><br><span class="line">        Phone lowPhone = <span class="keyword">new</span> Phone();</span><br><span class="line">        lowPhone.Cpu = <span class="keyword">new</span> LowCpu();</span><br><span class="line">        lowPhone.Mem = <span class="keyword">new</span> LowMem();</span><br><span class="line">        lowPhone.Screen = <span class="keyword">new</span> LowScreen();</span><br><span class="line">        lowPhone.Show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-3-工厂方法建筑"><a href="#3-3-工厂方法建筑" class="headerlink" title="3.3 工厂方法建筑"></a>3.3 工厂方法建筑</h4><blockquote>
<p>定义一个工厂来完成类属性的创建，可以屏幕创造细节，但是类会非常多。</p>
<p>优点：</p>
<ul>
<li>屏蔽了配件的创造细节。</li>
<li>配置可灵活搭配。</li>
</ul>
<p>缺点：</p>
<ul>
<li>复杂度急剧增大，类爆炸。</li>
<li>把配件的组装交给手机类(Phone)处理不合理。</li>
<li>没有屏蔽手机创造细节。</li>
</ul>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Cpu</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Cpu</span> &#123; <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">string</span> Type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; &#125;</span><br><span class="line"><span class="comment">// Cpu工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">CpuBuilder</span> &#123; <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Cpu <span class="title">BuildCpu</span>()</span>; &#125;</span><br><span class="line"><span class="comment">// 高级Cpu</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HighCpu</span>:<span class="title">Cpu</span> &#123; <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = <span class="string">&quot;6核12线程&quot;</span>; &#125;</span><br><span class="line"><span class="comment">// 高级Cpu工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HighCpuBuilder</span>: <span class="title">CpuBuilder</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> Cpu <span class="title">BuildCpu</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HighCpu();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 低级Cpu</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LowCpu</span>: <span class="title">Cpu</span> &#123; <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = <span class="string">&quot;双核4线程&quot;</span>; &#125;</span><br><span class="line"><span class="comment">// 低级Cpu工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LowCpuBuilder</span> : <span class="title">CpuBuilder</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> Cpu <span class="title">BuildCpu</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LowCpu();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 内存和屏幕类同理</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 手机</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Phone</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Phone</span>(<span class="params">ScreenBuilder screenBuilder, CpuBuilder cpuBuilder, MemBuilder memBuilder</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.Screen = screenBuilder.BuildScreen();</span><br><span class="line">        <span class="keyword">this</span>.Cpu = cpuBuilder.BuildCpu();</span><br><span class="line">        <span class="keyword">this</span>.Mem = memBuilder.BuildMem();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Cpu Cpu &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Screen Screen &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Mem Mem &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Show</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;手机配置:&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;CPU:<span class="subst">&#123;Cpu?.Type&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;内存:<span class="subst">&#123;Mem?.Type&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;屏幕:<span class="subst">&#123;Screen?.Type&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        ScreenBuilder highScreenBuilder = <span class="keyword">new</span> HighScreenBuilder();</span><br><span class="line">        CpuBuilder highCpuBuilder = <span class="keyword">new</span> HighCpuBuilder();</span><br><span class="line">        MemBuilder highMemBuilder = <span class="keyword">new</span> HighMemBuilder();</span><br><span class="line"></span><br><span class="line">        Phone phone = <span class="keyword">new</span> Phone(highScreenBuilder, highCpuBuilder, highMemBuilder);</span><br><span class="line">        phone.Show();</span><br><span class="line">        Console.WriteLine();</span><br><span class="line"></span><br><span class="line">        ScreenBuilder lowScreenBuilder = <span class="keyword">new</span> LowScreenBuilder();</span><br><span class="line">        CpuBuilder lowCpuBuilder = <span class="keyword">new</span> LowCpuBuilder();</span><br><span class="line">        MemBuilder lowMemBuilder = <span class="keyword">new</span> LowMemBuilder();</span><br><span class="line"></span><br><span class="line">        Phone lowPhone = <span class="keyword">new</span> Phone(lowScreenBuilder, lowCpuBuilder, lowMemBuilder);</span><br><span class="line">        lowPhone.Show();</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-4-标准建筑者模式"><a href="#3-4-标准建筑者模式" class="headerlink" title="3.4 标准建筑者模式"></a>3.4 标准建筑者模式</h4><blockquote>
<p>利用抽象工厂+简单工厂实现，简单工厂负责生成最终的对象，抽象工厂负责对最终对象的相关联的属性进行组合。</p>
<p>和工厂模式的区别：工厂模式是创建了一组相关联的对象，然后对象之间进行操作。而建筑者模式是在内部对关联对象直接进行操作，最终只生成一个更大的对象。</p>
<p>优点：</p>
<ul>
<li>一定程度上，消除了类爆炸问题。</li>
<li>职责分离，由单独一个生产线组装手机。</li>
</ul>
<p>缺点：</p>
<ul>
<li>配件配置变得固定了，不能随意组合。</li>
<li>对大多数场景依然过于复杂，比如，未必每一个配置的手机都需要一个生产线，组装手机也未必需要一个单独的生产线。</li>
</ul>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Cpu</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Cpu</span> &#123; <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">string</span> Type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; &#125;</span><br><span class="line"><span class="comment">// 低级Cpu</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LowCpu</span>:<span class="title">Cpu</span> &#123; <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = <span class="string">&quot;双核4线程&quot;</span>; &#125;</span><br><span class="line"><span class="comment">// 高级Cpu</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HighCpu</span>:<span class="title">Cpu</span> &#123; <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = <span class="string">&quot;6核12线程&quot;</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 内存和屏幕同理</span></span><br><span class="line">...</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 低端手机建筑者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LowPhonePartBuilder</span>: <span class="title">PhonePartBuilder</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> Cpu <span class="title">BuildCpu</span>()</span> &#123; <span class="keyword">return</span> <span class="keyword">new</span> LowCpu(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> Mem <span class="title">BuildMem</span>()</span> &#123; <span class="keyword">return</span> <span class="keyword">new</span> LowMem(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> Screen <span class="title">BuildScreen</span>()</span> &#123; <span class="keyword">return</span> <span class="keyword">new</span> LowScreen(); &#125;</span><br><span class="line">&#125;    </span><br><span class="line"><span class="comment">// 高端手机建筑者  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HighPhonePartBuilder</span>: <span class="title">PhonePartBuilder</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> Cpu <span class="title">BuildCpu</span>()</span> &#123; <span class="keyword">return</span> <span class="keyword">new</span> HighCpu(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> Mem <span class="title">BuildMem</span>()</span> &#123; <span class="keyword">return</span> <span class="keyword">new</span> HighMem(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> Screen <span class="title">BuildScreen</span>()</span> &#123; <span class="keyword">return</span> <span class="keyword">new</span> HighScreen(); &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 手机建筑者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">PhonePartBuilder</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Cpu <span class="title">BuildCpu</span>()</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Mem <span class="title">BuildMem</span>()</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Screen <span class="title">BuildScreen</span>()</span>;</span><br><span class="line">&#125;    </span><br><span class="line">    </span><br><span class="line"><span class="comment">// 手机工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PhoneFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> PhonePartBuilder _phonePartBuilder;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PhoneFactory</span>(<span class="params">PhonePartBuilder phonePartBuilder</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _phonePartBuilder = phonePartBuilder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetPhoneBuilder</span>(<span class="params">PhonePartBuilder phonePartBuilder</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _phonePartBuilder = phonePartBuilder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Phone <span class="title">BuildPhone</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line">        phone.Cpu = _phonePartBuilder?.BuildCpu();</span><br><span class="line">        phone.Mem = _phonePartBuilder?.BuildMem();</span><br><span class="line">        phone.Screen = _phonePartBuilder?.BuildScreen();</span><br><span class="line">        <span class="keyword">return</span> phone;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;    </span><br><span class="line">    </span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PhonePartBuilder highPartBuilder = <span class="keyword">new</span> HighPhonePartBuilder();</span><br><span class="line">        <span class="comment">// 组装高端机</span></span><br><span class="line">        PhoneFactory phoneFactory = <span class="keyword">new</span> PhoneFactory(highPartBuilder);</span><br><span class="line">        Phone highPhone = phoneFactory.BuildPhone();</span><br><span class="line">        highPhone.Show();</span><br><span class="line">        Console.WriteLine();</span><br><span class="line">        <span class="comment">// 低装高端机</span></span><br><span class="line">        phoneFactory.SetPhoneBuilder(<span class="keyword">new</span> LowPhonePartBuilder());</span><br><span class="line">        Phone lowPhone = phoneFactory.BuildPhone();</span><br><span class="line">        lowPhone.Show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-5-优化建筑者模式"><a href="#3-5-优化建筑者模式" class="headerlink" title="3.5 优化建筑者模式"></a>3.5 优化建筑者模式</h4><blockquote>
<p>只保留一个最终对象的建筑者，其他的通过接口在内部实现。</p>
<p>优点：简单，灵活，代码优雅。</p>
<p>缺点：用户使用成本相对较高，需要使用者自己配置内部参数。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 配件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Cpu</span> &#123; <span class="keyword">public</span> <span class="built_in">string</span> Type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Mem</span> &#123; <span class="keyword">public</span> <span class="built_in">string</span> Type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Screen</span> &#123; <span class="keyword">public</span> <span class="built_in">string</span> Type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 手机</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Phone</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Cpu Cpu &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> Screen Screen &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> Mem Mem &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Show</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;手机配置:&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;CPU:<span class="subst">&#123;Cpu?.Type&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;内存:<span class="subst">&#123;Mem?.Type&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;屏幕:<span class="subst">&#123;Screen?.Type&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 手机建筑者接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IPhoneBuilder</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">IPhoneBuilder <span class="title">BuildCpu</span>(<span class="params">Action&lt;Cpu&gt; buildCpuDelegate</span>)</span>;</span><br><span class="line">    <span class="function">IPhoneBuilder <span class="title">BuildMem</span>(<span class="params">Action&lt;Mem&gt; buildMemDelegate</span>)</span>;</span><br><span class="line">    <span class="function">IPhoneBuilder <span class="title">BuildScreen</span>(<span class="params">Action&lt;Screen&gt; buildScreenDelegate</span>)</span>;</span><br><span class="line">    <span class="function">Phone <span class="title">Build</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 手机建筑者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PhoneBuilder</span>:<span class="title">IPhoneBuilder</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Phone _phone;</span><br><span class="line">    <span class="keyword">private</span> Cpu _cpu;</span><br><span class="line">    <span class="keyword">private</span> Mem _mem;</span><br><span class="line">    <span class="keyword">private</span> Screen _screen;</span><br><span class="line">	<span class="comment">// 使用委托</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IPhoneBuilder <span class="title">BuildCpu</span>(<span class="params">Action&lt;Cpu&gt; buildCpuDelegate</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _cpu = <span class="keyword">new</span> Cpu();</span><br><span class="line">        buildCpuDelegate?.Invoke(_cpu);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IPhoneBuilder <span class="title">BuildMem</span>(<span class="params">Action&lt;Mem&gt; buildMemDelegate</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _mem = <span class="keyword">new</span> Mem();</span><br><span class="line">        buildMemDelegate?.Invoke(_mem);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IPhoneBuilder <span class="title">BuildScreen</span>(<span class="params">Action&lt;Screen&gt; buildScreenDelegate</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _screen = <span class="keyword">new</span> Screen();</span><br><span class="line">        buildScreenDelegate?.Invoke(_screen);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Phone <span class="title">Build</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        _phone = <span class="keyword">new</span> Phone();</span><br><span class="line">        _phone.Cpu = _cpu??<span class="keyword">new</span> Cpu() &#123; Type=<span class="string">&quot;4核8线程&quot;</span>&#125;;</span><br><span class="line">        _phone.Mem = _mem??<span class="keyword">new</span> Mem() &#123; Type = <span class="string">&quot;8G&quot;</span> &#125;;</span><br><span class="line">        _phone.Screen = _screen??<span class="keyword">new</span> Screen() &#123; Type = <span class="string">&quot;7寸&quot;</span> &#125;;</span><br><span class="line">        <span class="keyword">return</span> _phone;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        IPhoneBuilder phoneBuilder = <span class="keyword">new</span> PhoneBuilder();</span><br><span class="line">        <span class="comment">// 手动输入参数，不输入则使用建筑者中的默认值</span></span><br><span class="line">        Phone phone = phoneBuilder</span><br><span class="line">            .BuildCpu(cpu =&gt; &#123; cpu.Type = <span class="string">&quot;8核16线程&quot;</span>; &#125;)</span><br><span class="line">            .BuildMem(mem =&gt; &#123; mem.Type = <span class="string">&quot;32G&quot;</span>; &#125;)</span><br><span class="line">            .BuildScreen(screen =&gt; &#123; screen.Type = <span class="string">&quot;10寸&quot;</span>; &#125;)</span><br><span class="line">            .Build();</span><br><span class="line">        phone.Show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-原形模式"><a href="#4-原形模式" class="headerlink" title="4 原形模式"></a>4 原形模式</h3><h4 id="4-1-Prototype概念"><a href="#4-1-Prototype概念" class="headerlink" title="4.1 Prototype概念"></a>4.1 Prototype概念</h4><blockquote>
<p>定义：原型模式是用原型实例指定创建对象的种类，并通过拷贝这些原型创建新的对象。简单地说就是，首先创建一个实例，然后通过这个实例去拷贝（克隆）创建新的实例。</p>
<p>案例：通常情况下，找工作时，需要准备多份简历，简历信息大致相同，但是可以根据不同的公司的岗位需求微调工作经历细节，以及薪资要求。</p>
<p>使用场景：</p>
<ul>
<li>当需要重复创建一个包含大量公共属性，而只需要修改少量属性的对象时。</li>
<li>当需要重复创建一个初始化需要消耗大量资源的对象时。</li>
</ul>
<p>优点：创建大量重复的对象，同时保证性能。</p>
<p>注意：</p>
<ul>
<li>尽量将实现原型模式的类标记为<code>sealed</code>。</li>
<li>尽量避免使用<code>ICloneable</code>接口。</li>
</ul>
</blockquote>
<h4 id="4-2-手动克隆"><a href="#4-2-手动克隆" class="headerlink" title="4.2 手动克隆"></a>4.2 手动克隆</h4><blockquote>
<p>手动将克隆的内容写在Clone中。因为新加内容后需要修改源码，因此违背了开闭原则。</p>
<p>该方法要多次new了ItResume对象（可以通过观察构造函数的执行次数发现），一样需要消耗资源。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 个人信息类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BasicInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Gender &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Age &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> ExpectedSalary &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工作经历类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WorkExperence</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Company &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Detail &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> DateTime StartDate &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> DateTime EndDate &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Display</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;工作经历:&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;<span class="subst">&#123;<span class="keyword">this</span>.Company&#125;</span>\t<span class="subst">&#123;<span class="keyword">this</span>.StartDate.ToShortDateString()&#125;</span>-<span class="subst">&#123;EndDate.ToShortDateString()&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;工作详细:&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="keyword">this</span>.Detail);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 简历抽象类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">ResumeBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Gender &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Age &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> ExpectedSalary &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Display</span>()</span>;</span><br><span class="line">    <span class="comment">// 用于复制简历</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> ResumeBase <span class="title">Clone</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 简历抽象类实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ItResume</span> : <span class="title">ResumeBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 可以在此处加断点观察新建对象次数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ItResume</span>()</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// 工作经历</span></span><br><span class="line">    <span class="keyword">public</span> WorkExperence WorkExperence &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Display</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;姓名:\t<span class="subst">&#123;<span class="keyword">this</span>.Name&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;性别:\t<span class="subst">&#123;<span class="keyword">this</span>.Gender&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;年龄:\t<span class="subst">&#123;<span class="keyword">this</span>.Age&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;期望薪资:\t<span class="subst">&#123;<span class="keyword">this</span>.ExpectedSalary&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;--------------------------------&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.WorkExperence != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.WorkExperence.Display();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;--------------------------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// 重点：克隆方式不同</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> ResumeBase <span class="title">Clone</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 新建对象并手动将每个元素复制</span></span><br><span class="line">        ItResume resume = <span class="keyword">new</span> ItResume()</span><br><span class="line">        &#123;</span><br><span class="line">            Name = <span class="keyword">this</span>.Name,</span><br><span class="line">            Gender = <span class="keyword">this</span>.Gender,</span><br><span class="line">            Age = <span class="keyword">this</span>.Age,</span><br><span class="line">            ExpectedSalary = <span class="keyword">this</span>.ExpectedSalary,</span><br><span class="line">            WorkExperence = <span class="keyword">new</span> WorkExperence</span><br><span class="line">            &#123;</span><br><span class="line">                Company = <span class="keyword">this</span>.WorkExperence.Company,</span><br><span class="line">                Detail = <span class="keyword">this</span>.WorkExperence.Detail,</span><br><span class="line">                StartDate = <span class="keyword">this</span>.WorkExperence.StartDate,</span><br><span class="line">                EndDate = <span class="keyword">this</span>.WorkExperence.EndDate</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> resume;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 简历构建接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IResumeBuilder</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 构建个人信息和工作细节</span></span><br><span class="line">    <span class="function">IResumeBuilder <span class="title">BuildBasicInfo</span>(<span class="params">Action&lt;BasicInfo&gt; buildBasicInfoDelegate</span>)</span>;</span><br><span class="line">    <span class="function">IResumeBuilder <span class="title">BuildWorkExperence</span>(<span class="params">Action&lt;WorkExperence&gt; buildWorkExperenceDelegate</span>)</span>;</span><br><span class="line">    <span class="function">ResumeBase <span class="title">Build</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简历构建类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ResumeBuilder</span> : <span class="title">IResumeBuilder</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> BasicInfo _basicInfo = <span class="keyword">new</span> BasicInfo();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> WorkExperence _workExperence = <span class="keyword">new</span> WorkExperence();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IResumeBuilder <span class="title">BuildBasicInfo</span>(<span class="params">Action&lt;BasicInfo&gt; buildBasicInfoDelegate</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        buildBasicInfoDelegate?.Invoke(_basicInfo);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IResumeBuilder <span class="title">BuildWorkExperence</span>(<span class="params">Action&lt;WorkExperence&gt; buildWorkExperenceDelegate</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        buildWorkExperenceDelegate?.Invoke(_workExperence);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResumeBase <span class="title">Build</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        ItResume resume = <span class="keyword">new</span> ItResume()</span><br><span class="line">        &#123;</span><br><span class="line">            Name = <span class="keyword">this</span>._basicInfo.Name,</span><br><span class="line">            Gender = <span class="keyword">this</span>._basicInfo.Gender,</span><br><span class="line">            Age = <span class="keyword">this</span>._basicInfo.Age,</span><br><span class="line">            ExpectedSalary = <span class="keyword">this</span>._basicInfo.ExpectedSalary,</span><br><span class="line">            WorkExperence = <span class="keyword">new</span> WorkExperence</span><br><span class="line">            &#123;</span><br><span class="line">                Company = <span class="keyword">this</span>._workExperence.Company,</span><br><span class="line">                Detail = <span class="keyword">this</span>._workExperence.Detail,</span><br><span class="line">                StartDate = <span class="keyword">this</span>._workExperence.StartDate,</span><br><span class="line">                EndDate = <span class="keyword">this</span>._workExperence.EndDate</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> resume;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        IResumeBuilder resumeBuilder = <span class="keyword">new</span> ResumeBuilder()</span><br><span class="line">            .BuildBasicInfo(resume =&gt;</span><br><span class="line">                            &#123;</span><br><span class="line">                                resume.Name = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">                                resume.Age = <span class="number">18</span>;</span><br><span class="line">                                resume.Gender = <span class="string">&quot;男&quot;</span>;</span><br><span class="line">                                resume.ExpectedSalary = <span class="string">&quot;100W&quot;</span>;</span><br><span class="line">                            &#125;)</span><br><span class="line">            .BuildWorkExperence(work =&gt;</span><br><span class="line">                                &#123;</span><br><span class="line">                                    work.Company = <span class="string">&quot;A公司&quot;</span>;</span><br><span class="line">                                    work.Detail = <span class="string">&quot;负责XX系统开发,精通YY。。。。。&quot;</span>;</span><br><span class="line">                                    work.StartDate = DateTime.Parse(<span class="string">&quot;2019-1-1&quot;</span>);</span><br><span class="line">                                    work.EndDate = DateTime.Parse(<span class="string">&quot;2020-1-1&quot;</span>);</span><br><span class="line">                                &#125;);</span><br><span class="line"></span><br><span class="line">        ResumeBase resume1 = resumeBuilder</span><br><span class="line">            .Build();</span><br><span class="line"></span><br><span class="line">        ItResume resume2 = resume1.Clone() <span class="keyword">as</span> ItResume;</span><br><span class="line">        resume2.ExpectedSalary = <span class="string">&quot;面议&quot;</span>;</span><br><span class="line">        resume2.WorkExperence.Detail = <span class="string">&quot;aaaaaaaaaa&quot;</span>;</span><br><span class="line">        resume1.Display();</span><br><span class="line">        resume2.Display();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-浅拷贝克隆"><a href="#4-3-浅拷贝克隆" class="headerlink" title="4.3 浅拷贝克隆"></a>4.3 浅拷贝克隆</h4><blockquote>
<p>部分内容直接浅拷贝，需要深拷贝的内容将手动进行拷贝。一样违背了开闭原则。</p>
<p>该方法只需要new了一次ItResume对象（可以通过观察构造函数的执行次数发现），其他的通过拷贝完成，相对消耗资源较少。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 给WorkExperence加上Clone函数，克隆WorkExperence中的内容</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WorkExperence</span></span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WorkExperence <span class="title">Clone</span>()</span> &#123; <span class="keyword">return</span> <span class="keyword">this</span>.MemberwiseClone() <span class="keyword">as</span> WorkExperence; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其他不变，只改变克隆函数</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> ResumeBase <span class="title">Clone</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 对简历其他属性进行浅拷贝，工作经历是类，需要深拷贝或者手动克隆里面的内容。</span></span><br><span class="line">    ItResume itResume = <span class="keyword">this</span>.MemberwiseClone() <span class="keyword">as</span> ItResume;</span><br><span class="line">    <span class="comment">// 手动克隆里面的内容</span></span><br><span class="line">    itResume.WorkExperence = <span class="keyword">this</span>.WorkExperence.Clone();</span><br><span class="line">    <span class="keyword">return</span> itResume;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-4-序列化克隆"><a href="#4-4-序列化克隆" class="headerlink" title="4.4 序列化克隆"></a>4.4 序列化克隆</h4><blockquote>
<p>通过序列化对象，可以将对象转换为字节流，然后再从字节流中反序列化出一个新的对象，实现了对象的深复制，从而实现了克隆的效果。最推荐。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 需要加上序列化标签</span></span><br><span class="line"><span class="comment">// WorkExperence中的Clone()可以删除</span></span><br><span class="line">[<span class="meta">Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WorkExperence</span> &#123;&#125;</span><br><span class="line">[<span class="meta">Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">ResumeBase</span> &#123;&#125;</span><br><span class="line">[<span class="meta">Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">ItResume</span> : <span class="title">ResumeBase</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改克隆函数，通过序列化方式实现（函数名最好改成DeepClone，和浅拷贝区分）</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> ResumeBase <span class="title">Clone</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">using</span> (MemoryStream stream = <span class="keyword">new</span> MemoryStream())</span><br><span class="line">    &#123;</span><br><span class="line">        BinaryFormatter bf = <span class="keyword">new</span> BinaryFormatter();</span><br><span class="line">        bf.Serialize(stream, <span class="keyword">this</span>);</span><br><span class="line">        stream.Position = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> bf.Deserialize(stream) <span class="keyword">as</span> ResumeBase;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-5-ICloneable克隆"><a href="#4-5-ICloneable克隆" class="headerlink" title="4.5 ICloneable克隆"></a>4.5 ICloneable克隆</h4><blockquote>
<p>利用<code>C#</code>自带的ICloneable进行克隆。</p>
<p>基本思想如下：</p>
<ol>
<li>由于只有一个Clone方法，因此调用者无法区分到底是深拷贝还是浅拷贝，会给调用者造成极大的困扰；</li>
<li>如果基类继承了<code>ICloneable</code>接口，并且非Sealed类型，那么它的所有派生类都需要实现Clone方法。否则，用派生类对象调用Clone方法，返回的对象将会是基类Clone方法创建的对象，这就给派生类带来了沉重的负担,因此在非密封类中应该避免实现 <code>ICloneable</code> 接口，但这个不是<code>ICloneable</code>特有的缺陷，任何一种方式实现原型模式都存在该问题，因此建议将原型模式的实现类设置为密封类。</li>
<li>Clone方法返回值是<code>object</code>，是非类型安全的；</li>
</ol>
<p><code>ICloneable</code>被很多人认为是一个糟糕的设计，其他理由如下：</p>
<ol>
<li><code>ICloneable</code>除了标识可被克隆之外，无论作为参数还是返回值都没有任何意义；</li>
<li><code>.Net Framework</code>在升级支持泛型至今，都没有添加一个与之对应的<code>ICloneable&lt;T&gt;</code>泛型接口；</li>
<li>很多框架中为了向下兼容，虽然实现了<code>ICloneable</code>接口，但是内部只提供了一个抛出异常的私有实现，例如<code>SqlConnection</code>。</li>
</ol>
<p>鉴于上述诸多缺点，在实现原型模式时，<code>ICloneable</code>接口能不用就不要用了，自己定义一个更有意义的方法或许会更好。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 代码直接删除ResumeBase，改成继承ICloneable。其他返回值是ResumeBase地方将返回值改成ItResume</span></span><br><span class="line">[<span class="meta">Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">ItResume</span> : <span class="title">ICloneable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Gender &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Age &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> ExpectedSalary &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> WorkExperence WorkExperence &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// 不需要写override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Display</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;姓名:\t<span class="subst">&#123;<span class="keyword">this</span>.Name&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;性别:\t<span class="subst">&#123;<span class="keyword">this</span>.Gender&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;年龄:\t<span class="subst">&#123;<span class="keyword">this</span>.Age&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;期望薪资:\t<span class="subst">&#123;<span class="keyword">this</span>.ExpectedSalary&#125;</span>&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;--------------------------------&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.WorkExperence != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.WorkExperence.Display();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;--------------------------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// 不需要写override，返回值变成object</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">Clone</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> (MemoryStream stream = <span class="keyword">new</span> MemoryStream())</span><br><span class="line">        &#123;</span><br><span class="line">            BinaryFormatter bf = <span class="keyword">new</span> BinaryFormatter();</span><br><span class="line">            bf.Serialize(stream, <span class="keyword">this</span>);</span><br><span class="line">            stream.Position = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> bf.Deserialize(stream);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="三、结构型"><a href="#三、结构型" class="headerlink" title="三、结构型"></a>三、结构型</h2><h3 id="1-适配器模式"><a href="#1-适配器模式" class="headerlink" title="1 适配器模式"></a>1 适配器模式</h3><h4 id="1-1-Adapter概念"><a href="#1-1-Adapter概念" class="headerlink" title="1.1 Adapter概念"></a>1.1 Adapter概念</h4><blockquote>
<p>定义：将一个类的接口转换成客户希望的另外一个接口。适配器模式将原本由于接口不兼容而不能一起工作的那些类可以一起工作。类似于读卡器。</p>
<p>优点：</p>
<ol>
<li>可以让任何两个没有关联的类一起运行。</li>
<li>提高了类的复用。</li>
<li>通过引入一个适配器类来重用现有的类，而无须修改原有结构，遵守了开闭原则。</li>
</ol>
<p>缺点：过多地使用适配器，会让系统非常零乱，不易整体进行把握。</p>
<p>总结：适配器模式属于补偿机制，专门用来在系统后期扩展、修改时使用。因此，适配器模式也不宜过度使用，如果可以的话，我们应该优先通过重构解决。</p>
</blockquote>
<h4 id="1-2-电脑适配器案例"><a href="#1-2-电脑适配器案例" class="headerlink" title="1.2 电脑适配器案例"></a>1.2 电脑适配器案例</h4><blockquote>
<p>角色：</p>
<ul>
<li>使用者：Client，使用接口的对象。</li>
</ul>
<ul>
<li>目标接口：Target，我们期望的接口。</li>
<li>适配器：Adapter，将被适配者转换成我们期望的形式。</li>
<li>被适配者：Adaptee，原有的接口。</li>
</ul>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Client</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Computer</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Computer只有usb接口</span></span><br><span class="line">    <span class="keyword">private</span> IUsb _usb;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetUsb</span>(<span class="params">IUsb usb</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _usb = usb;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// 使用接口</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConnectUsb</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_usb != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            _usb.Request();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Target，Usb接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IUsb</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Request</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Adapter，继承IUsb，对IUsb作适配</span></span><br><span class="line"><span class="comment">// 此处使用Sd要使用组合或聚合的方式（在类的内部使用），而不要使用继承的方式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SdReader</span> : <span class="title">IUsb</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 作适配，读取Sd对象中的数据</span></span><br><span class="line">    <span class="keyword">private</span> Sd _sd;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SdReader</span>(<span class="params">Sd sd</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _sd = sd;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重写Usb接口，返回Sd对象中的数据</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Request</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        _sd.ReadWrite();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Adaptee，数据对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Sd</span> &#123; <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ReadWrite</span>()</span> &#123; Console.WriteLine(<span class="string">&quot;存取数据&quot;</span>); &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Client对象</span></span><br><span class="line">        Computer computer = <span class="keyword">new</span> Computer();</span><br><span class="line">        <span class="comment">// Adaptee对象</span></span><br><span class="line">        Sd sd = <span class="keyword">new</span> Sd();</span><br><span class="line">        <span class="comment">// 利用Adapter装载Adaptee</span></span><br><span class="line">        computer.SetUsb(<span class="keyword">new</span> SdReader(sd));</span><br><span class="line">        <span class="comment">// 读取Adaptee</span></span><br><span class="line">        computer.ConnectUsb();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-代理模式"><a href="#2-代理模式" class="headerlink" title="2 代理模式"></a>2 代理模式</h3><h4 id="2-1-Proxy概念"><a href="#2-1-Proxy概念" class="headerlink" title="2.1 Proxy概念"></a>2.1 Proxy概念</h4><blockquote>
<p>定义：为其他对象提供一种代理以控制对这个对象的访问。例如防火墙、VPN等。</p>
<p>目的：</p>
<ol>
<li>在不改变原有代码的基础上，对原有类加以控制。</li>
<li>访问由于某种原因不能直接访问或者直接访问困难的第三方组件或中间件。</li>
</ol>
<p>和适配器比较：</p>
<ol>
<li>适配器模式的目的是接口转换，使原本不兼容而不能一起工作的类可以一起工作。</li>
<li>代理模式的目的是间接访问和访问控制。</li>
<li>适配器模式面向的是不能一起工作的两个类，而代理模式是面向原本可以一起工作的两个类。</li>
</ol>
<p>总结：随着系统复杂度的发展，代理模式更偏向于是一种架构模式，在各种框架中以及与各种中间件交互是是非常常见的，而在我们自己的代码中反而很少见了，它更多的体现的是一种思想，而非代码实现。</p>
</blockquote>
<h4 id="2-2-图片加载案例"><a href="#2-2-图片加载案例" class="headerlink" title="2.2 图片加载案例"></a>2.2 图片加载案例</h4><blockquote>
<p>通过代理模式，可以对图片更好地进行操作。当图片展示时，如果图片已经加载过了，就不用再重复加载，提高了效率。这种延迟加载的方式可以优化系统性能，减少资源消耗。</p>
<p>这里体现了和适配器模式的不同之处，适配器模式需要进行适配才能正常使用，而代理模式原件本身是可以直接使用的，只是通过代理对象可以更加方便和安全地对原件进行控制和管理。代理模式提供了对原始对象的间接访问，通过代理对象可以在不改变原始对象的情况下，增加额外的功能或控制访问权限。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IImage</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 真实主题（原始图片操作）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RealImage</span> : <span class="title">IImage</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> _fileName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RealImage</span>(<span class="params"><span class="built_in">string</span> fileName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _fileName = fileName;</span><br><span class="line">        LoadImageFromDisk();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LoadImageFromDisk</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Loading image from disk: &quot;</span> + _fileName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Display</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Displaying image: &quot;</span> + _fileName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理类（辅助图片处理）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProxyImage</span> : <span class="title">IImage</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> RealImage _realImage;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> _fileName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProxyImage</span>(<span class="params"><span class="built_in">string</span> fileName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _fileName = fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Display</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_realImage == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            _realImage = <span class="keyword">new</span> RealImage(_fileName);</span><br><span class="line">        &#125;</span><br><span class="line">        _realImage.Display();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        IImage image = <span class="keyword">new</span> ProxyImage(<span class="string">&quot;test.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第一次调用Display方法，会加载图片</span></span><br><span class="line">        image.Display();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第二次调用Display方法，不会再次加载图片</span></span><br><span class="line">        image.Display();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="3-外观模式"><a href="#3-外观模式" class="headerlink" title="3 外观模式"></a>3 外观模式</h3><h4 id="3-1-Facade概念"><a href="#3-1-Facade概念" class="headerlink" title="3.1 Facade概念"></a>3.1 Facade概念</h4><blockquote>
<p>定义：为子系统中的一组接口提供一个一致的界面，外观模式定义了一个高层接口，这个接口使得这一子系统更加容易使用。</p>
<p>目的：</p>
<ol>
<li>为一个复杂的模块或子系统提供一个一致的外界访问接口，降低客户端访问子系统的复杂度。</li>
<li>使客户端与子系统之间解耦，让子系统内部模块更易维护和扩展。</li>
<li>进行访问控制，提高系统安全性。</li>
<li>维护大型遗留系统。</li>
</ol>
<p>外观模式跟代理模式类似，也更偏向于架构模式，常见于企业应用集成中，企业应用集成包括界面集成，业务流程集成（过程集成），控制集成（应用集成，API集成），数据集成四个层面，都与外观模式有密切关系。</p>
<p>外观模式简单来说就是开发好了多个功能，然后为它们做好界面并进行组装。</p>
<p>和代理模式之间的相同点</p>
<ul>
<li>都可以在不改变子系统代码的基础上，对子系统加以控制；</li>
<li>原有系统之间都是可以直接访问的，两个模式都是为了让子系统更加容易使用；</li>
<li>都不应该在其中添加子系统没有的功能。</li>
</ul>
<p>和代理模式之间的不同点：</p>
<ul>
<li>外观模式面向的是多个不同的子系统，而代理模式通常面向的是一个（或者多个相同的）子系统。</li>
<li>外观模式更多强调是对多个子系统的整合，而代理模式更多强调的是对某个子系统的代理。</li>
</ul>
<p>极端情况下，假如外观模式中的子系统只有一个，就跟代理模式差不多了，这有点像抽象工厂模式和工厂方法模式之间的关系。</p>
</blockquote>
<h4 id="3-2-回家案例"><a href="#3-2-回家案例" class="headerlink" title="3.2 回家案例"></a>3.2 回家案例</h4><blockquote>
<p>外观模式可以将回家后的多个单体操作（如开空调、开灯、关电视、关窗）聚合成一组操作，例如回家、睡觉、出门。这样可以简化用户的操作流程，提高代码的可读性和可维护性。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 回家的操作</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AirConditioner</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TurnOn</span>()</span> &#123; Console.WriteLine(<span class="string">&quot;开空调...&quot;</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TurnOff</span>()</span> &#123; Console.WriteLine(<span class="string">&quot;关空调...&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Light</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TurnOn</span>()</span> &#123; Console.WriteLine(<span class="string">&quot;开灯...&quot;</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TurnOff</span>()</span> &#123; Console.WriteLine(<span class="string">&quot;关灯...&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Tv</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TurnOn</span>()</span> &#123; Console.WriteLine(<span class="string">&quot;打开电视机...&quot;</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TurnOff</span>()</span> &#123; Console.WriteLine(<span class="string">&quot;关闭电视机...&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Window</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Open</span>()</span> &#123; Console.WriteLine(<span class="string">&quot;开窗...&quot;</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Close</span>()</span> &#123; Console.WriteLine(<span class="string">&quot;关窗...&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 外观</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OneClickFacade</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Window _window = <span class="keyword">new</span> Window();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Tv _tv = <span class="keyword">new</span> Tv();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Light _light = <span class="keyword">new</span> Light();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> AirConditioner _airConditioner = <span class="keyword">new</span> AirConditioner();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">BackHome</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;--------回家--------&quot;</span>);</span><br><span class="line">        _tv.TurnOn();</span><br><span class="line">        _light.TurnOn();</span><br><span class="line">        _airConditioner.TurnOn();</span><br><span class="line">        _window.Open();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Sleep</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;--------睡觉--------&quot;</span>);</span><br><span class="line">        _window.Close();</span><br><span class="line">        _tv.TurnOff();</span><br><span class="line">        _light.TurnOff();</span><br><span class="line">        _airConditioner.TurnOn();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LeaveHome</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;--------出门--------&quot;</span>);</span><br><span class="line">        _window.Close();</span><br><span class="line">        _tv.TurnOff();</span><br><span class="line">        _light.TurnOff();</span><br><span class="line">        _airConditioner.TurnOff();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        OneClickFacade oneClickFacade = <span class="keyword">new</span> OneClickFacade();</span><br><span class="line">        oneClickFacade.BackHome();</span><br><span class="line">        oneClickFacade.Sleep();</span><br><span class="line">        oneClickFacade.LeaveHome();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-装饰器模式"><a href="#4-装饰器模式" class="headerlink" title="4 装饰器模式"></a>4 装饰器模式</h3><h4 id="4-1-Decorator概念"><a href="#4-1-Decorator概念" class="headerlink" title="4.1 Decorator概念"></a>4.1 Decorator概念</h4><blockquote>
<p>装饰器模式是一种结构型设计模式，它允许在不改变原有对象结构的情况下，动态地添加额外的功能或责任。该模式通过创建一组装饰类来包装原始类，每个装饰类负责添加一部分功能，通过嵌套调用来实现功能层层叠加。</p>
<p>在装饰器模式中，每个具体装饰器类继承自一个通用的抽象装饰器类，同时持有一个指向被装饰对象的引用。这样，客户端可以透明地使用被装饰对象和装饰对象，它们之间的差异对客户端来说是透明的。装饰器模式可以避免继承的混乱，让类的功能可以动态地组合和追加。</p>
<p>总结来说，装饰器模式提供了一种灵活的方式来扩展对象的功能，同时保持对象的简单性和独立性。</p>
<p>装饰器模式跟代理模式类图基本一样，但是，它们之间却有很大的区别：</p>
<ul>
<li>装饰器模式关注于在一个对象上动态的添加方法，而代理模式关注于控制对对象的访问。</li>
<li>装饰器模式通常用聚合的方式，而代理模式通常采用组合的方式。</li>
<li>装饰器模式通常会套用多层，而代理模式通常只有一层。 但是由于他们的结构十分相似，因此很多时候二者可以做同样的事，比如装饰器模式和代理模式都可用于实现AOP（面向切面编程）。</li>
</ul>
</blockquote>
<h4 id="4-2-奶茶非装饰器案例"><a href="#4-2-奶茶非装饰器案例" class="headerlink" title="4.2  奶茶非装饰器案例"></a>4.2  奶茶非装饰器案例</h4><blockquote>
<p>案例的需求是基类有饮料和配料，然后饮料分奶茶、咖啡等，配料分冰、布丁等。</p>
<p>非装饰器模式中，饮料和配料是独立的，在饮料中加配料的功能是写在饮料中的。</p>
<p>优点：</p>
<ul>
<li>可任意搭配组合，并且满足新增饮品的需求。</li>
<li>新增饮品和配料均只需要增加新的类即可，满足开闭原则。</li>
</ul>
<p>缺点：</p>
<ul>
<li>依然需要修改饮料类，这在很多时候是不被允许的，或者说做不到的。</li>
<li>Add方法不合理，饮料不应该具有添加配料的能力。</li>
</ul>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 配料实例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Bing</span>: <span class="title">Peiliao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Name =&gt; <span class="string">&quot;冰&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Price =&gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Buding</span>: <span class="title">Peiliao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Name =&gt; <span class="string">&quot;布丁&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Price =&gt; <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Hongdou</span>: <span class="title">Peiliao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Name =&gt; <span class="string">&quot;红豆&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Price =&gt; <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Tang</span>: <span class="title">Peiliao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Name =&gt; <span class="string">&quot;糖&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Price =&gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Zhenzhu</span>: <span class="title">Peiliao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Name =&gt; <span class="string">&quot;珍珠&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Price =&gt; <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Kafeibanlv</span>: <span class="title">Peiliao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Name =&gt; <span class="string">&quot;咖啡伴侣&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Price =&gt; <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配料基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Peiliao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">int</span> Price &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 饮料实例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Naicha</span>: <span class="title">Drink</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Naicha</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = <span class="string">&quot;奶茶&quot;</span>;</span><br><span class="line">        Price = <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Kafei</span>: <span class="title">Drink</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Kafei</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = <span class="string">&quot;咖啡&quot;</span>;</span><br><span class="line">        Price = <span class="number">12</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 饮料基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Drink</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">protected</span> List&lt;Peiliao&gt; Peiliaos = <span class="keyword">new</span> List&lt;Peiliao&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Price &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Cost</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> cost = <span class="keyword">this</span>.Price;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> peiliao <span class="keyword">in</span> Peiliaos)</span><br><span class="line">            &#123;</span><br><span class="line">                cost += peiliao.Price;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> cost;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Desc</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">string</span> desc = <span class="keyword">this</span>.Name;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> peiliao <span class="keyword">in</span> Peiliaos)</span><br><span class="line">            &#123;</span><br><span class="line">                desc += <span class="string">&quot;+&quot;</span> + peiliao.Name;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> desc;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddPeiliao</span>(<span class="params">Peiliao peiliao</span>)</span> &#123; Peiliaos.Add(peiliao); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Drink drink = <span class="keyword">new</span> Naicha();</span><br><span class="line">        drink.AddPeiliao(<span class="keyword">new</span> Bing());</span><br><span class="line">        drink.AddPeiliao(<span class="keyword">new</span> Hongdou());</span><br><span class="line">        drink.AddPeiliao(<span class="keyword">new</span> Hongdou());</span><br><span class="line">        drink.AddPeiliao(<span class="keyword">new</span> Zhenzhu());</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;描述：<span class="subst">&#123;drink.Desc&#125;</span>,价格:<span class="subst">&#123;drink.Cost&#125;</span>&quot;</span>);</span><br><span class="line">        Drink drink2 = <span class="keyword">new</span> Kafei();</span><br><span class="line">        drink2.AddPeiliao(<span class="keyword">new</span> Kafeibanlv());</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;描述：<span class="subst">&#123;drink2.Desc&#125;</span>,价格:<span class="subst">&#123;drink2.Cost&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-奶茶装饰器案例"><a href="#4-3-奶茶装饰器案例" class="headerlink" title="4.3 奶茶装饰器案例"></a>4.3 奶茶装饰器案例</h4><blockquote>
<p>通过组合+继承的方式改进，可使得饮品的扩展更灵活，同时也遵守了开闭原则。其中，组合是为了实现功能，而继承是为了约束类型，这其实就是装饰者模式。</p>
<p>在下面的代码中，配料不再在饮料中添加，而是在配料中添加功能，通过传递饮料来确定哪个饮料需要加配料（配料组合饮料的同时继承饮料）。</p>
<p>优点：</p>
<ul>
<li>可动态的给一个对象增加额外的职责。</li>
<li>有很好地可扩展性。</li>
</ul>
<p>缺点：增加了程序的复杂度，刚接触理解起来会比较困难。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 配料实例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Bing</span>: <span class="title">Peiliao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Bing</span>(<span class="params">Drink drink</span>) : <span class="title">base</span>(<span class="params">drink</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = <span class="string">&quot;冰&quot;</span>;</span><br><span class="line">        Price = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Buding</span>: <span class="title">Peiliao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Buding</span>(<span class="params">Drink drink</span>) : <span class="title">base</span>(<span class="params">drink</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = <span class="string">&quot;布丁&quot;</span>;</span><br><span class="line">        Price = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Hongdou</span>: <span class="title">Peiliao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Hongdou</span>(<span class="params">Drink drink</span>) : <span class="title">base</span>(<span class="params">drink</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = <span class="string">&quot;红豆&quot;</span>;</span><br><span class="line">        Price = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Tang</span>: <span class="title">Peiliao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Tang</span>(<span class="params">Drink drink</span>) : <span class="title">base</span>(<span class="params">drink</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = <span class="string">&quot;糖&quot;</span>;</span><br><span class="line">        Price = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Zhenzhu</span>: <span class="title">Peiliao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Zhenzhu</span>(<span class="params">Drink drink</span>) : <span class="title">base</span>(<span class="params">drink</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = <span class="string">&quot;珍珠&quot;</span>;</span><br><span class="line">        Price = <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Kafeibanlv</span>: <span class="title">Peiliao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Kafeibanlv</span>(<span class="params">Drink drink</span>) : <span class="title">base</span>(<span class="params">drink</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = <span class="string">&quot;咖啡伴侣&quot;</span>;</span><br><span class="line">        Price = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配料基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Peiliao</span>: <span class="title">Drink</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">readonly</span> Drink Drink;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Peiliao</span>(<span class="params">Drink drink</span>)</span> &#123; Drink = drink; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Desc &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> Drink.Desc + <span class="string">&quot;+&quot;</span> + <span class="keyword">this</span>.Name; &#125; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Cost &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> Drink.Cost + <span class="keyword">this</span>.Price; &#125; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 饮料实例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Naicha</span>: <span class="title">Drink</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Naicha</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = <span class="string">&quot;奶茶&quot;</span>;</span><br><span class="line">        Price = <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Desc =&gt; <span class="keyword">this</span>.Name;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Cost =&gt; <span class="keyword">this</span>.Price;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Kafei</span>: <span class="title">Drink</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Kafei</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = <span class="string">&quot;咖啡&quot;</span>;</span><br><span class="line">        Price = <span class="number">12</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Desc =&gt; <span class="keyword">this</span>.Name;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Cost =&gt; <span class="keyword">this</span>.Price;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 饮料基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Drink</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Price &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">string</span> Desc &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">int</span> Cost &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Drink drink = <span class="keyword">new</span> Naicha();</span><br><span class="line">        drink = <span class="keyword">new</span> Hongdou(drink);</span><br><span class="line">        drink = <span class="keyword">new</span> Bing(drink);</span><br><span class="line">        drink = <span class="keyword">new</span> Buding(drink);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;描述：<span class="subst">&#123;drink.Desc&#125;</span>,价格:<span class="subst">&#123;drink.Cost&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Drink drink2 = <span class="keyword">new</span> Kafei();</span><br><span class="line">        drink2 = <span class="keyword">new</span> Kafeibanlv(drink2);</span><br><span class="line">        drink2 = <span class="keyword">new</span> Tang(drink2);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;描述：<span class="subst">&#123;drink2.Desc&#125;</span>,价格:<span class="subst">&#123;drink2.Cost&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-桥接模式"><a href="#5-桥接模式" class="headerlink" title="5 桥接模式"></a>5 桥接模式</h3><h4 id="5-1-Bridge概念"><a href="#5-1-Bridge概念" class="headerlink" title="5.1 Bridge概念"></a>5.1 Bridge概念</h4><blockquote>
<p>桥接模式是将抽象部分与它的实现部分分离，使它们都可以独立地变化。</p>
<p>在桥接模式中，抽象部分定义了对象的行为和属性，而实现部分则负责实现这些行为和属性。通过将抽象部分和实现部分独立出来，我们可以在不影响彼此的情况下，扩展或修改它们。桥接模式通过组合关系而非继承关系，避免了类的爆炸性增长，并更灵活地适应不同需求的变化。</p>
<p>跟装饰器模式的区别：</p>
<ul>
<li>装饰器模式是为了动态地给一个对象增加功能，而桥接模式是为了让类在多个维度上自由扩展。</li>
<li>装饰器模式的装饰者和被装饰者需要继承自同一父类，而桥接模式通常不需要。</li>
<li>装饰器模式通常可以嵌套使用，而桥接模式不能。</li>
</ul>
</blockquote>
<h4 id="5-2-奶茶桥接案例"><a href="#5-2-奶茶桥接案例" class="headerlink" title="5.2 奶茶桥接案例"></a>5.2 奶茶桥接案例</h4><blockquote>
<p>在奶茶点单场景中，将品牌、容量和饮品分离开来，通过组合关系来实现不同品牌、不同容量的饮品组合。</p>
<p>饮品是作用的主体，品牌、容量等是附加属性，组合在饮品当中。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 品牌实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CoCo</span>: <span class="title">BrandBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> BrandName =&gt; <span class="string">&quot;[CoCo]&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Price =&gt; <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Ruixin</span>: <span class="title">BrandBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> BrandName =&gt; <span class="string">&quot;[瑞辛]&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Price =&gt; <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Xicha</span>: <span class="title">BrandBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> BrandName =&gt; <span class="string">&quot;[喜茶]&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Price =&gt; <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Yidiandian</span>: <span class="title">BrandBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> BrandName =&gt; <span class="string">&quot;[一点点]&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Price =&gt; <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 品牌基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">BrandBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">string</span> BrandName &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">int</span> Price &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 容量实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Dabei</span> : <span class="title">SkuBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> SkuType =&gt; <span class="string">&quot;大杯&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Price =&gt; <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Zhongbei</span> : <span class="title">SkuBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> SkuType =&gt; <span class="string">&quot;中杯&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Price =&gt; <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Xiaobei</span> : <span class="title">SkuBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> SkuType =&gt; <span class="string">&quot;小杯&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> Price =&gt; <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 容量基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">SkuBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">string</span> SkuType &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">int</span> Price &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 饮品实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Naicha</span>: <span class="title">Drink</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Naicha</span>(<span class="params">BrandBase brand, SkuBase sku</span>):<span class="title">base</span>(<span class="params">brand,sku</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = <span class="string">&quot;奶茶&quot;</span>;</span><br><span class="line">        Price = <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Kafei</span>: <span class="title">Drink</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Kafei</span>(<span class="params">BrandBase brand, SkuBase sku</span>) : <span class="title">base</span>(<span class="params">brand, sku</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = <span class="string">&quot;咖啡&quot;</span>;</span><br><span class="line">        Price = <span class="number">12</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 饮品基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Drink</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> BrandBase _brand;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> SkuBase _sku;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Drink</span>(<span class="params">BrandBase brand, SkuBase sku</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>._brand = brand;</span><br><span class="line">        <span class="keyword">this</span>._sku = sku;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Price &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Desc</span><br><span class="line">    &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> <span class="keyword">this</span>.Name + <span class="keyword">this</span>._brand.BrandName + <span class="keyword">this</span>._sku.SkuType; &#125; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Cost</span><br><span class="line">    &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> <span class="keyword">this</span>.Price + <span class="keyword">this</span>._brand.Price + <span class="keyword">this</span>._sku.Price; &#125; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        BrandBase brand = <span class="keyword">new</span> Ruixin();</span><br><span class="line">        SkuBase sku = <span class="keyword">new</span> Dabei();</span><br><span class="line">        Drink drink = <span class="keyword">new</span> Kafei(brand, sku);</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;描述：<span class="subst">&#123;drink.Desc&#125;</span>,价格:<span class="subst">&#123;drink.Cost&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-组合模式"><a href="#6-组合模式" class="headerlink" title="6 组合模式"></a>6 组合模式</h3><h4 id="6-1-Composite概念"><a href="#6-1-Composite概念" class="headerlink" title="6.1 Composite概念"></a>6.1 Composite概念</h4><blockquote>
<p>定义：将对象组合成树形结构以表示“部分-整体”的层次结构。组合模式使得对单个对象和组合对象的使用具有一致性。</p>
<p>案例：文件系统中的文件与文件夹、Winform中的简单控件与容器控件、XML中的Node和Element等。</p>
<p>优点:</p>
<ul>
<li>客户端调用简单，可以像处理简单元素一样来处理复杂元素,从而使得客户程序与复杂元素的内部结构解耦。</li>
<li>可以方便的在结构中增加或者移除对象。</li>
</ul>
<p>缺点：客户端需要花更多时间理清类之间的层次关系。</p>
</blockquote>
<h4 id="6-2-透明模式"><a href="#6-2-透明模式" class="headerlink" title="6.2 透明模式"></a>6.2 透明模式</h4><blockquote>
<p>透明模式是把组合使用的方法放到抽象类中，使得叶子对象和枝干对象具有相同的结构，客户端调用时具备完全一致的行为接口。但因为Leaf类本身不具备Add()、Remove()方法的功能，所以实现它是没有意义的，违背了单一职责原则和里氏替换原则。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 数据库中的数据存储方式如下</span></span><br><span class="line"><span class="comment">// 节点数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CatalogService</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">region</span> 数据</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> List&lt;Node&gt; _nodes = <span class="keyword">new</span> List&lt;Node&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">new</span> Node&#123;Id=<span class="number">1</span>,Name=<span class="string">&quot;音乐&quot;</span>,ParentId=<span class="number">0</span>&#125;,</span><br><span class="line">        <span class="keyword">new</span> Node&#123;Id=<span class="number">2</span>,Name=<span class="string">&quot;知识&quot;</span>,ParentId=<span class="number">0</span>&#125;,</span><br><span class="line">        <span class="keyword">new</span> Node&#123;Id=<span class="number">3</span>,Name=<span class="string">&quot;生活&quot;</span>,ParentId=<span class="number">0</span>&#125;,</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Node&#123;Id=<span class="number">4</span>,Name=<span class="string">&quot;科学科普&quot;</span>,ParentId=<span class="number">2</span>&#125;,</span><br><span class="line">        <span class="keyword">new</span> Node&#123;Id=<span class="number">5</span>,Name=<span class="string">&quot;社科人文&quot;</span>,ParentId=<span class="number">2</span>&#125;,</span><br><span class="line">        <span class="keyword">new</span> Node&#123;Id=<span class="number">6</span>,Name=<span class="string">&quot;职业职场&quot;</span>,ParentId=<span class="number">2</span>&#125;,</span><br><span class="line">        <span class="keyword">new</span> Node&#123;Id=<span class="number">7</span>,Name=<span class="string">&quot;野生技术协会&quot;</span>,ParentId=<span class="number">2</span>&#125;,</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Node&#123;Id=<span class="number">8</span>,Name=<span class="string">&quot;搞笑&quot;</span>,ParentId=<span class="number">3</span>&#125;,</span><br><span class="line">        <span class="keyword">new</span> Node&#123;Id=<span class="number">9</span>,Name=<span class="string">&quot;日常&quot;</span>,ParentId=<span class="number">3</span>&#125;,</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Node&#123;Id=<span class="number">10</span>,Name=<span class="string">&quot;摄影&quot;</span>,ParentId=<span class="number">7</span>&#125;,</span><br><span class="line">        <span class="keyword">new</span> Node&#123;Id=<span class="number">11</span>,Name=<span class="string">&quot;编程&quot;</span>,ParentId=<span class="number">7</span>&#125;,</span><br><span class="line">        <span class="keyword">new</span> Node&#123;Id=<span class="number">12</span>,Name=<span class="string">&quot;英语&quot;</span>,ParentId=<span class="number">7</span>&#125;,</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Node&#123;Id=<span class="number">13</span>,Name=<span class="string">&quot;科学科普文章1&quot;</span>,ParentId=<span class="number">4</span>&#125;,</span><br><span class="line">        <span class="keyword">new</span> Node&#123;Id=<span class="number">14</span>,Name=<span class="string">&quot;科学科普文章2&quot;</span>,ParentId=<span class="number">4</span>&#125;,</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Node&#123;Id=<span class="number">15</span>,Name=<span class="string">&quot;摄影文章1&quot;</span>,ParentId=<span class="number">10</span>&#125;,</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Node&#123;Id=<span class="number">16</span>,Name=<span class="string">&quot;编程文章1&quot;</span>,ParentId=<span class="number">11</span>&#125;,</span><br><span class="line">        <span class="keyword">new</span> Node&#123;Id=<span class="number">17</span>,Name=<span class="string">&quot;编程文章2&quot;</span>,ParentId=<span class="number">11</span>&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 节点基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Node</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> ParentId &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 透明模式设计如下</span></span><br><span class="line"><span class="comment">// 叶子节点（没有后续节点）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Leaf</span> : <span class="title">Component</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Leaf</span>(<span class="params"><span class="built_in">string</span> name</span>) : <span class="title">base</span>(<span class="params">name</span>)</span> &#123;&#125;</span><br><span class="line">	<span class="comment">// 叶子节点不能添加元素，所以抛出异常</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Add</span>(<span class="params">Component component</span>)</span> &#123; <span class="keyword">throw</span> <span class="keyword">new</span> InvalidOperationException(<span class="string">&quot;叶子节点不能添加元素&quot;</span>); &#125;</span><br><span class="line">	<span class="comment">// 叶子节点不能删除元素，所以抛出异常</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Remove</span>(<span class="params">Component component</span>)</span> &#123; <span class="keyword">throw</span> <span class="keyword">new</span> InvalidOperationException(<span class="string">&quot;叶子节点不能删除元素&quot;</span>); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> <span class="title">SumArticleCount</span>()</span> &#123; <span class="keyword">return</span> <span class="number">1</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Display</span>(<span class="params"><span class="built_in">int</span> depth</span>)</span>&#123; Console.WriteLine(<span class="keyword">new</span> <span class="built_in">string</span>(<span class="string">&#x27;-&#x27;</span>, depth) + Name); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 混合节点（后续可以接混合节点或叶子节点）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Composite</span> : <span class="title">Component</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Component&gt; _components = <span class="keyword">new</span> List&lt;Component&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Composite</span>(<span class="params"><span class="built_in">string</span> name</span>):<span class="title">base</span>(<span class="params">name</span>)</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Add</span>(<span class="params">Component component</span>)</span> &#123; _components.Add(component); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Remove</span>(<span class="params">Component component</span>)</span> &#123; _components.Remove(component); &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// 递归展示数据</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Display</span>(<span class="params"><span class="built_in">int</span> depth</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="keyword">new</span> <span class="built_in">string</span>(<span class="string">&#x27;-&#x27;</span>, depth) + Name);</span><br><span class="line">        <span class="keyword">foreach</span> (Component component <span class="keyword">in</span> _components)</span><br><span class="line">        &#123;</span><br><span class="line">            component.Display(depth + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 递归统计数据</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> <span class="title">SumArticleCount</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> _components)</span><br><span class="line">        &#123;</span><br><span class="line">            count += item.SumArticleCount();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件节点（叶子和混合的基类，拥有子类所有的方法）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Component</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Component</span>(<span class="params"><span class="built_in">string</span> name</span>)</span> &#123; <span class="keyword">this</span>.Name = name; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">int</span> <span class="title">SumArticleCount</span>()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Add</span>(<span class="params">Component component</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Remove</span>(<span class="params">Component component</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Display</span>(<span class="params"><span class="built_in">int</span> depth</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Component root = <span class="keyword">new</span> Composite(<span class="string">&quot;目录&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Component music = <span class="keyword">new</span> Composite(<span class="string">&quot;音乐&quot;</span>);</span><br><span class="line">        Component knowledge = <span class="keyword">new</span> Composite(<span class="string">&quot;知识&quot;</span>);</span><br><span class="line">        Component life = <span class="keyword">new</span> Composite(<span class="string">&quot;生活&quot;</span>);</span><br><span class="line">        root.Add(music);</span><br><span class="line">        root.Add(knowledge);</span><br><span class="line">        root.Add(life);</span><br><span class="line"></span><br><span class="line">        Component science = <span class="keyword">new</span> Composite(<span class="string">&quot;科学科普&quot;</span>);</span><br><span class="line">        Component tech = <span class="keyword">new</span> Composite(<span class="string">&quot;野生技术协会&quot;</span>);</span><br><span class="line">        knowledge.Add(science);</span><br><span class="line">        knowledge.Add(tech);</span><br><span class="line"></span><br><span class="line">        Component scienceArticle1 = <span class="keyword">new</span> Leaf(<span class="string">&quot;科学科普文章1&quot;</span>);</span><br><span class="line">        Component scienceArticle2 = <span class="keyword">new</span> Leaf(<span class="string">&quot;科学科普文章2&quot;</span>);</span><br><span class="line">        science.Add(scienceArticle1);</span><br><span class="line">        science.Add(scienceArticle2);</span><br><span class="line"></span><br><span class="line">        Component shoot = <span class="keyword">new</span> Composite(<span class="string">&quot;摄影&quot;</span>);</span><br><span class="line">        Component program = <span class="keyword">new</span> Composite(<span class="string">&quot;编程&quot;</span>);</span><br><span class="line">        Component english = <span class="keyword">new</span> Composite(<span class="string">&quot;英语&quot;</span>);</span><br><span class="line">        tech.Add(shoot);</span><br><span class="line">        tech.Add(program);</span><br><span class="line">        tech.Add(english);</span><br><span class="line"></span><br><span class="line">        Component shootArticle1 = <span class="keyword">new</span> Leaf(<span class="string">&quot;摄影文章1&quot;</span>);</span><br><span class="line">        Component lifeArticle1 = <span class="keyword">new</span> Leaf(<span class="string">&quot;生活文章1&quot;</span>);</span><br><span class="line">        Component lifeArticle2 = <span class="keyword">new</span> Leaf(<span class="string">&quot;生活文章2&quot;</span>);</span><br><span class="line">        shoot.Add(shootArticle1);</span><br><span class="line">        life.Add(lifeArticle1);</span><br><span class="line">        life.Add(lifeArticle2);</span><br><span class="line"></span><br><span class="line">        tech.Remove(program);</span><br><span class="line">        knowledge.Display(<span class="number">0</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;文章数：&quot;</span>+ knowledge.SumArticleCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-3-安全模式"><a href="#6-3-安全模式" class="headerlink" title="6.3 安全模式"></a>6.3 安全模式</h4><blockquote>
<p>安全模式是把枝干和叶子节点区分开来，枝干单独拥有用来组合的方法，这种方法比较安全。但枝干和叶子节点不具有相同的接口，客户端的调用需要做相应的判断，违背了依赖倒置原则。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 叶子节点（没有后续节点）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Leaf</span> : <span class="title">Component</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Leaf</span>(<span class="params"><span class="built_in">string</span> name</span>) : <span class="title">base</span>(<span class="params">name</span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> <span class="title">SumArticleCount</span>()</span>&#123; <span class="keyword">return</span> <span class="number">1</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Display</span>(<span class="params"><span class="built_in">int</span> depth</span>)</span> &#123; Console.WriteLine(<span class="keyword">new</span> <span class="built_in">string</span>(<span class="string">&#x27;-&#x27;</span>, depth) + Name); &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 混合节点（后续可以接混合节点或叶子节点）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Composite</span> : <span class="title">Component</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Component&gt; _components = <span class="keyword">new</span> List&lt;Component&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Composite</span>(<span class="params"><span class="built_in">string</span> name</span>):<span class="title">base</span>(<span class="params">name</span>)</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Add</span>(<span class="params">Component component</span>)</span> &#123;  _components.Add(component);  &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Remove</span>(<span class="params">Component component</span>)</span> &#123;  _components.Remove(component); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Display</span>(<span class="params"><span class="built_in">int</span> depth</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="keyword">new</span> <span class="built_in">string</span>(<span class="string">&#x27;-&#x27;</span>, depth) + Name);</span><br><span class="line">        <span class="keyword">foreach</span> (Component component <span class="keyword">in</span> _components)</span><br><span class="line">        &#123;</span><br><span class="line">            component.Display(depth + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> <span class="title">SumArticleCount</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> _components)</span><br><span class="line">        &#123;</span><br><span class="line">            count += item.SumArticleCount();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件节点（叶子和混合的基类，只有子类共同的方法）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Component</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Component</span>(<span class="params"><span class="built_in">string</span> name</span>)</span> &#123; <span class="keyword">this</span>.Name = name; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">int</span> <span class="title">SumArticleCount</span>()</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Display</span>(<span class="params"><span class="built_in">int</span> depth</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 客户端必须用子类而不能用基类进行创建</span></span><br><span class="line">        Composite root = <span class="keyword">new</span> Composite(<span class="string">&quot;目录&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Composite music = <span class="keyword">new</span> Composite(<span class="string">&quot;音乐&quot;</span>);</span><br><span class="line">        Composite knowledge = <span class="keyword">new</span> Composite(<span class="string">&quot;知识&quot;</span>);</span><br><span class="line">        Composite life = <span class="keyword">new</span> Composite(<span class="string">&quot;生活&quot;</span>);</span><br><span class="line">        root.Add(music);</span><br><span class="line">        root.Add(knowledge);</span><br><span class="line">        root.Add(life);</span><br><span class="line"></span><br><span class="line">        Composite science = <span class="keyword">new</span> Composite(<span class="string">&quot;科学科普&quot;</span>);</span><br><span class="line">        Composite tech = <span class="keyword">new</span> Composite(<span class="string">&quot;野生技术协会&quot;</span>);</span><br><span class="line">        knowledge.Add(science);</span><br><span class="line">        knowledge.Add(tech);</span><br><span class="line"></span><br><span class="line">        Component scienceArticle1 = <span class="keyword">new</span> Leaf(<span class="string">&quot;科学科普文章1&quot;</span>);</span><br><span class="line">        Component scienceArticle2 = <span class="keyword">new</span> Leaf(<span class="string">&quot;科学科普文章2&quot;</span>);</span><br><span class="line">        science.Add(scienceArticle1);</span><br><span class="line">        science.Add(scienceArticle2);</span><br><span class="line"></span><br><span class="line">        Composite shoot = <span class="keyword">new</span> Composite(<span class="string">&quot;摄影&quot;</span>);</span><br><span class="line">        Composite program = <span class="keyword">new</span> Composite(<span class="string">&quot;编程&quot;</span>);</span><br><span class="line">        Composite english = <span class="keyword">new</span> Composite(<span class="string">&quot;英语&quot;</span>);</span><br><span class="line">        tech.Add(shoot);</span><br><span class="line">        tech.Add(program);</span><br><span class="line">        tech.Add(english);</span><br><span class="line"></span><br><span class="line">        Component shootArticle1 = <span class="keyword">new</span> Leaf(<span class="string">&quot;摄影文章1&quot;</span>);</span><br><span class="line">        Component lifeArticle1 = <span class="keyword">new</span> Leaf(<span class="string">&quot;生活文章1&quot;</span>);</span><br><span class="line">        Component lifeArticle2 = <span class="keyword">new</span> Leaf(<span class="string">&quot;生活文章2&quot;</span>);</span><br><span class="line">        shoot.Add(shootArticle1);</span><br><span class="line">        life.Add(lifeArticle1);</span><br><span class="line">        life.Add(lifeArticle2);</span><br><span class="line"></span><br><span class="line">        root.Display(<span class="number">0</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;文章数：&quot;</span> + root.SumArticleCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-享元模式"><a href="#7-享元模式" class="headerlink" title="7 享元模式"></a>7 享元模式</h3><h4 id="7-1-Flyweight概念"><a href="#7-1-Flyweight概念" class="headerlink" title="7.1 Flyweight概念"></a>7.1 Flyweight概念</h4><blockquote>
<p>定义：运用共享技术有效地支持大量细粒度的对象。简单来说就是类的复用，类似于单例模式，但是享元模式是很多个类的实例。</p>
<p>在享元模式中，其实存在共享出来的类和非共享出来的类。但是非共享出来的类用得比较少，一般如果类是非共享状态，那么也就没有创建它的必要了。</p>
<p>适用场景：</p>
<ul>
<li>系统会用到大量相同或相似的对象。</li>
<li>对象创建比较耗时。</li>
</ul>
<p>目的：</p>
<ul>
<li>减少创建对象的数量；</li>
<li>对象全局共享。</li>
</ul>
<p>案例：活字印刷、图书馆借书、共享单车。</p>
<p>应用实例：字符串驻留池、线程池、数据库连接池等。</p>
<p>优点：</p>
<ul>
<li>节省内存空间。</li>
<li>提高效率。</li>
</ul>
<p>缺点：增加了系统的复杂度。</p>
<p>与单例模式的区别：</p>
<ul>
<li>享元模式是共享大量类的大量实例，而单例是一个类一个实例。</li>
<li>单例模式针对的是对象的创建，而享元模式针对的是对象的管理。</li>
<li>单例模式不能单独创建，而享元模式可以单独创建。</li>
</ul>
<p>与简单工厂模式的区别：</p>
<ul>
<li>享元模式在简单工厂模式的基础上加入了缓存。</li>
<li>简单工厂模式的作用仅仅是创建对象，而享元模式虽然也创建对象，但其主要作用是管理对象。</li>
</ul>
</blockquote>
<h4 id="7-2-内部创建型"><a href="#7-2-内部创建型" class="headerlink" title="7.2 内部创建型"></a>7.2 内部创建型</h4><blockquote>
<p>利用单例模式 + 简单工厂模式实现对多个类的全局共享。</p>
<p>内部创建方式：工厂中存在已经写好了的要使用的类，使用时即可使用即可。</p>
<p>工厂中用一个字典存某个类是否创建过，创建过就不再重复创建。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 提前写好的类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ETypeface</span> : <span class="title">Typeface</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">Print</span>()</span> &#123; <span class="keyword">return</span> <span class="string">&quot;E&quot;</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HTypeface</span> : <span class="title">Typeface</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">Print</span>()</span> &#123; <span class="keyword">return</span> <span class="string">&quot;H&quot;</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LTypeface</span> : <span class="title">Typeface</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">Print</span>()</span> &#123; <span class="keyword">return</span> <span class="string">&quot;L&quot;</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OTypeface</span> : <span class="title">Typeface</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">Print</span>()</span> &#123; <span class="keyword">return</span> <span class="string">&quot;O&quot;</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提前类的基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Typeface</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">string</span> <span class="title">Print</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 简单工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TypefaceFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> IDictionary&lt;Type, Typeface&gt; _typefaces </span><br><span class="line">        = <span class="keyword">new</span> Dictionary&lt;Type, Typeface&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">object</span> _locker = <span class="keyword">new</span> <span class="built_in">object</span>();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Typeface <span class="title">GetTypeface</span>&lt;<span class="title">TTypeface</span>&gt;() <span class="keyword">where</span> TTypeface : Typeface</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 防高并发，需要加锁</span></span><br><span class="line">        Type type = <span class="keyword">typeof</span>(TTypeface);</span><br><span class="line">        <span class="keyword">if</span> (!_typefaces.ContainsKey(type))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">lock</span> (_locker)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (!_typefaces.ContainsKey(type))</span><br><span class="line">                &#123;</span><br><span class="line">                    Typeface typeface = Activator.CreateInstance(<span class="keyword">typeof</span>(TTypeface)) <span class="keyword">as</span> Typeface;</span><br><span class="line">                    _typefaces.Add(type, typeface);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _typefaces[type];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;<span class="subst">&#123;TypefaceFactory.GetTypeface&lt;HTypeface&gt;().Print()&#125;</span>&quot;</span> +</span><br><span class="line">                          <span class="string">$&quot;<span class="subst">&#123;TypefaceFactory.GetTypeface&lt;ETypeface&gt;().Print()&#125;</span><span class="subst">&#123;TypefaceFactory.GetTypeface&lt;LTypeface&gt;().Print()&#125;</span>&quot;</span> +</span><br><span class="line">                          <span class="string">$&quot;<span class="subst">&#123;TypefaceFactory.GetTypeface&lt;LTypeface&gt;().Print()&#125;</span><span class="subst">&#123;TypefaceFactory.GetTypeface&lt;OTypeface&gt;().Print()&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-3-外部创建型"><a href="#7-3-外部创建型" class="headerlink" title="7.3 外部创建型"></a>7.3 外部创建型</h4><blockquote>
<p>利用单例模式 + 简单工厂模式实现对多个类的全局共享。</p>
<p>外部创建方式：工厂中只有一个简单的基类，使用时客户端自行向工厂中加入案例并使用。</p>
<p>工厂中用一个字典存某个类是否创建过，创建过就不再重复创建。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 提前写好的类模版</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WordTypeface</span> : <span class="title">Typeface</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="built_in">string</span> _word;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WordTypeface</span>(<span class="params"><span class="built_in">string</span> word</span>)</span> &#123;<span class="keyword">this</span>._word = word; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">Print</span>()</span> &#123; <span class="keyword">return</span> <span class="keyword">this</span>._word; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 提前类的基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Typeface</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">string</span> <span class="title">Print</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 简单工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TypefaceFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> IDictionary&lt;<span class="built_in">string</span>, Typeface&gt; _typefaces</span><br><span class="line">        = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, Typeface&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">object</span> _locker = <span class="keyword">new</span> <span class="built_in">object</span>();</span><br><span class="line">	<span class="comment">// 设置数据</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SetTypeface</span>(<span class="params"><span class="built_in">string</span> key, Typeface typeface</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!_typefaces.ContainsKey(key)) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">lock</span> (_locker)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (!_typefaces.ContainsKey(key))</span><br><span class="line">                &#123;</span><br><span class="line">                    _typefaces.Add(key, typeface);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 获得数据</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Typeface <span class="title">GetTypeface</span>(<span class="params"><span class="built_in">string</span> key</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_typefaces.ContainsKey(key))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> _typefaces[key];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">        <span class="comment">// 手动向工厂中加入数据</span></span><br><span class="line">        TypefaceFactory.SetTypeface(<span class="string">&quot;hello&quot;</span>, <span class="keyword">new</span> WordTypeface(<span class="string">&quot;Hello&quot;</span>));</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(TypefaceFactory.GetTypeface(<span class="string">&quot;hello&quot;</span>).Print());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="四、行为型"><a href="#四、行为型" class="headerlink" title="四、行为型"></a>四、行为型</h2><h3 id="1-模版方法模式"><a href="#1-模版方法模式" class="headerlink" title="1 模版方法模式"></a>1 模版方法模式</h3><h4 id="1-1-TemplateMethod概念"><a href="#1-1-TemplateMethod概念" class="headerlink" title="1.1 TemplateMethod概念"></a>1.1 TemplateMethod概念</h4><blockquote>
<p>定义：定义一个操作中的算法的框架，而将一些步骤延迟到了子类中。使得子类可以不改变一个算法的结构即可重定义该算法的某些步骤。</p>
<p>简单来说就是定义好一个模板，后续用户在使用时可以按照这个模板进行具体实现。</p>
<p>优点：</p>
<ul>
<li>封装了算法骨架，提高了代码复用性，简化了使用难度。</li>
<li>封装不变部分，扩展可变部分，满足开闭原则。</li>
</ul>
<p>缺点：</p>
<ul>
<li>算法骨架不易更改。</li>
<li>扩展时，可能会产生很多子类。</li>
</ul>
</blockquote>
<h4 id="1-2-大象放冰箱案例"><a href="#1-2-大象放冰箱案例" class="headerlink" title="1.2 大象放冰箱案例"></a>1.2 大象放冰箱案例</h4><blockquote>
<p>案例：把大象放入冰箱的步骤？</p>
<p>实现：众所周知，把大象放入冰箱需要开冰箱门，放入大象，关冰箱门三步。所以可以定义一个模板，写好这三步。然后在子类中具体实现是放入大象还是放入狗。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 模版子类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ElephantToFridge</span>:<span class="title">AnimalToFridge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">PutIntoFridge</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;把大象放进去&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DogToFridge</span>: <span class="title">AnimalToFridge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">PutIntoFridge</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;把狗放进去&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 模版类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">AnimalToFridge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Do</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        OpenFridge();</span><br><span class="line">        PutIntoFridge();</span><br><span class="line">        CloseFridge();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OpenFridge</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;把冰箱门打开&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">PutIntoFridge</span>()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CloseFridge</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;把冰箱门关上&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        AnimalToFridge dogToFridge = <span class="keyword">new</span> DogToFridge();</span><br><span class="line">        dogToFridge.Do();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-长颈鹿放冰箱案例"><a href="#1-3-长颈鹿放冰箱案例" class="headerlink" title="1.3 长颈鹿放冰箱案例"></a>1.3 长颈鹿放冰箱案例</h4><blockquote>
<p>案例：把长颈鹿放入冰箱的步骤？</p>
<p>实现：因为大象在冰箱里，所以把长颈鹿放入冰箱需要四步，中间需要加上把大象拿出来这一步。那么在模板中，因为有的方法需要在子类实现有的不需要，所以可以写好一个钩子函数，然后子类进行选择性实现。</p>
<p>钩子函数：钩子就是给子类一个授权，让子类来可重定义模板方法的某些步骤，说白了就是虚函数。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 模版子类</span></span><br><span class="line"><span class="comment">// 大象不需要实现钩子函数</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ElephantToFridge</span> : <span class="title">AnimalToFridge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">PutIntoFridge</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;把大象放进去&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 长颈鹿需要实现钩子函数</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GiraffeToFridge</span> : <span class="title">AnimalToFridge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">BeforePutIntoFridge</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;把大象弄出来&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">PutIntoFridge</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;把长颈鹿放进去&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 模版类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">AnimalToFridge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Do</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        OpenFridge();</span><br><span class="line">        </span><br><span class="line">        BeforePutIntoFridge();</span><br><span class="line"></span><br><span class="line">        PutIntoFridge();</span><br><span class="line"></span><br><span class="line">        CloseFridge();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OpenFridge</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;把冰箱门打开&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 钩子函数</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">BeforePutIntoFridge</span>()</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">PutIntoFridge</span>()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CloseFridge</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;把冰箱门关上&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        AnimalToFridge elephant = <span class="keyword">new</span> ElephantToFridge();</span><br><span class="line">        elephant.Do();</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;--------------&quot;</span>);</span><br><span class="line">        AnimalToFridge giraffe = <span class="keyword">new</span> GiraffeToFridge();</span><br><span class="line">        giraffe.Do();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-4-客户端自定义"><a href="#1-4-客户端自定义" class="headerlink" title="1.4 客户端自定义"></a>1.4 客户端自定义</h4><blockquote>
<p>利用委托，不用子类进行实现，而是在客户端中进行实现，适合算法不难，不重复使用的场景。</p>
<p>优点：自由度高。</p>
<p>缺点：调用困难，需要客户实现。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 模版类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AnimalToFridge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Do</span>(<span class="params">Action beforePutIntoFridge,Action putIntoFridge</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        OpenFridge();</span><br><span class="line">		<span class="comment">// 客户端输入函数进行执行</span></span><br><span class="line">        beforePutIntoFridge?.Invoke();</span><br><span class="line"></span><br><span class="line">        putIntoFridge?.Invoke();</span><br><span class="line"></span><br><span class="line">        CloseFridge();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OpenFridge</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;把冰箱门打开&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CloseFridge</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;把冰箱门关上&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        AnimalToFridge elephant = <span class="keyword">new</span> AnimalToFridge();</span><br><span class="line">        elephant.Do(<span class="literal">null</span>, () =&gt;</span><br><span class="line">                    &#123;</span><br><span class="line">                        Console.WriteLine(<span class="string">&quot;把大象放进去&quot;</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;--------------&quot;</span>);</span><br><span class="line">        AnimalToFridge giraffe = <span class="keyword">new</span> AnimalToFridge();</span><br><span class="line">        giraffe.Do(() =&gt;</span><br><span class="line">                   &#123;</span><br><span class="line">                       Console.WriteLine(<span class="string">&quot;把大象弄出来&quot;</span>);</span><br><span class="line">                   &#125;, () =&gt;</span><br><span class="line">                   &#123;</span><br><span class="line">                       Console.WriteLine(<span class="string">&quot;把长颈鹿放进去&quot;</span>);</span><br><span class="line">                   &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-策略模式"><a href="#2-策略模式" class="headerlink" title="2 策略模式"></a>2 策略模式</h3><h4 id="2-1-Strategy概念"><a href="#2-1-Strategy概念" class="headerlink" title="2.1 Strategy概念"></a>2.1 Strategy概念</h4><blockquote>
<p>定义：定义一系列算法，把他们一个个封装起来，并且使他们可以互相替换。该模式使得算法可以独立于使用它的客户程序而变化。</p>
<p>应用场景：促销活动，日志、缓存等。</p>
</blockquote>
<h4 id="2-2-画板案例"><a href="#2-2-画板案例" class="headerlink" title="2.2 画板案例"></a>2.2 画板案例</h4><blockquote>
<p>策略模式对象：</p>
<ul>
<li><strong>Context</strong>：策略上下文，持有<code>IStrategy</code>的引用，负责和具体的策略实现交互。</li>
<li><strong>IStrategy</strong>：策略接口，约束一系列具体的策略算法。</li>
<li><strong>ConcreteStrategy</strong>：具体的策略实现。</li>
</ul>
<p>在下述案例中，Context就是画板，IStrategy就是绘画、填充等动作，ConcreteStrategy就是具体的工具，比如用笔画、用刷子画、用刷子填充、用油漆桶填充等。</p>
<p>优点：</p>
<ul>
<li>策略可以互相替换。</li>
<li>解决<code>switch-case</code>、<code>if-else</code>带来的难以维护的问题。</li>
<li>策略易于扩展，满足开闭原则。</li>
</ul>
<p>缺点：</p>
<ul>
<li>随着策略的扩展，策略类数量会增多。</li>
<li>客户端必须知道每一个策略类，增加了使用难度。</li>
</ul>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ConcreteStrategy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PenStrokeStrategy</span> : <span class="title">IStrokeStrategy</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Stroke</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;用钢笔描边图形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BrushStrokeStrategy</span> : <span class="title">IStrokeStrategy</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Stroke</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;用笔刷描边图形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BrushFillStrategy</span> : <span class="title">IFillStrategy</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Fill</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;用笔刷填充图形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BucketFillStrategy</span> : <span class="title">IFillStrategy</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Fill</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;用油漆桶填充图形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// IStrategy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IStrokeStrategy</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Stroke</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IFillStrategy</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Fill</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Context</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Graphics</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> IStrokeStrategy _strokeStrategy;</span><br><span class="line">    <span class="keyword">private</span> IFillStrategy _fillStrategy;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Graphics</span>(<span class="params">IStrokeStrategy strokeStrategy,</span></span></span><br><span class="line"><span class="params"><span class="function">                    IFillStrategy fillStrategy</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>._strokeStrategy = strokeStrategy;</span><br><span class="line">        <span class="keyword">this</span>._fillStrategy = fillStrategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Stroke</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>._strokeStrategy.Stroke();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Fill</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>._fillStrategy.Fill();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        IStrokeStrategy strokeStrategy = <span class="keyword">new</span> PenStrokeStrategy();</span><br><span class="line">        IFillStrategy fillStrategy = <span class="keyword">new</span> BrushFillStrategy();</span><br><span class="line"></span><br><span class="line">        Graphics graphics = <span class="keyword">new</span> Graphics(strokeStrategy, fillStrategy);</span><br><span class="line"></span><br><span class="line">        graphics.Stroke();</span><br><span class="line">        graphics.Fill();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-简单工厂优化"><a href="#2-3-简单工厂优化" class="headerlink" title="2.3 简单工厂优化"></a>2.3 简单工厂优化</h4><blockquote>
<p>由上述案例可知，随着策略的扩展，策略类数量会增多。因此我们可以用工厂模式进行管理，下列是用简单工厂进行管理的案例。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ConcreteStrategy 和 IStrategy 不变</span></span><br><span class="line">...;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加工具（IStrategy）枚举</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> StrokeWith</span><br><span class="line">&#123;</span><br><span class="line">    Pen,</span><br><span class="line">    Brush</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> FillWith</span><br><span class="line">&#123;</span><br><span class="line">    Brush,</span><br><span class="line">    Bucket</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">StrokeStrategyFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IStrokeStrategy <span class="title">CreateStrokeStrategy</span>(<span class="params">StrokeWith stroke</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">switch</span> (stroke)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> StrokeWith.Pen:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> PenStrokeStrategy();</span><br><span class="line">            <span class="keyword">case</span> StrokeWith.Brush:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> BrushStrokeStrategy();</span><br><span class="line">            <span class="literal">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NotSupportedException(<span class="string">&quot;不支持的描边方式&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">FillStrategyFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IFillStrategy <span class="title">CreateFillStrategy</span>(<span class="params">FillWith fill</span>)</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">switch</span> (fill)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> FillWith.Brush:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> BrushFillStrategy();</span><br><span class="line">            <span class="keyword">case</span> FillWith.Bucket:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> BucketFillStrategy();</span><br><span class="line">            <span class="literal">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NotSupportedException(<span class="string">&quot;不支持的填充方式&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Context 添加代码 SetStrokeStrategy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Graphics</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> IStrokeStrategy _strokeStrategy;</span><br><span class="line">    <span class="keyword">private</span> IFillStrategy _fillStrategy;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Graphics</span>(<span class="params">IStrokeStrategy strokeStrategy,</span></span></span><br><span class="line"><span class="params"><span class="function">                    IFillStrategy fillStrategy</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>._strokeStrategy = strokeStrategy;</span><br><span class="line">        <span class="keyword">this</span>._fillStrategy = fillStrategy;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 添加设置策略</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetStrokeStrategy</span>(<span class="params">IStrokeStrategy strokeStrategy</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>._strokeStrategy = strokeStrategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Stroke</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>._strokeStrategy.Stroke();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Fill</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>._fillStrategy.Fill();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        IStrokeStrategy strokeStrategy = StrokeStrategyFactory.CreateStrokeStrategy(StrokeWith.Pen);</span><br><span class="line">        IFillStrategy fillStrategy = FillStrategyFactory.CreateFillStrategy(FillWith.Bucket);</span><br><span class="line"></span><br><span class="line">        Graphics graphics = <span class="keyword">new</span> Graphics(strokeStrategy, fillStrategy);</span><br><span class="line"></span><br><span class="line">        graphics.Stroke();</span><br><span class="line">        graphics.Fill();</span><br><span class="line"></span><br><span class="line">        graphics.SetStrokeStrategy(StrokeStrategyFactory.CreateStrokeStrategy(StrokeWith.Brush));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-状态模式"><a href="#3-状态模式" class="headerlink" title="3 状态模式"></a>3 状态模式</h3><h4 id="3-1-State概念"><a href="#3-1-State概念" class="headerlink" title="3.1 State概念"></a>3.1 State概念</h4><blockquote>
<p>定义：允许一个对象在其内部状态改变时改变它的行为，从而使对象看起来似乎修改了它的类。</p>
<p>优点：</p>
<ul>
<li>解决<code>switch-case</code>、<code>if-else</code>带来的难以维护的问题；</li>
<li>结构清晰，提高了扩展性；</li>
<li>通过单例或享元可使状态在多个上下文间共享。</li>
</ul>
<p>缺点：</p>
<ul>
<li>随着状态的扩展，状态类数量会增多；</li>
<li>增加了系统复杂度，使用不当将会导致逻辑的混乱；</li>
<li>不完全满足开闭原则。</li>
</ul>
<p>相比较策略模式：</p>
<ul>
<li>强策略模式强调可以互换的算法；状态模式强调改变对象内部的状态来帮助控制自己的行为。</li>
<li>策略模式中用户直接与具体算法交互，决定算法的替换，需要了解算法本身；状态模式中状态是对象内部流转，用户不会直接跟状态交互，不需要了解状态本身。</li>
<li>策略模式策略类不需要持有<strong>Context</strong>的引用。状态模式中状态类需要持有<strong>Context</strong>的引用，用来实现状态转移。</li>
</ul>
</blockquote>
<h4 id="3-2-有限状态机"><a href="#3-2-有限状态机" class="headerlink" title="3.2 有限状态机"></a>3.2 有限状态机</h4><blockquote>
<p>有限状态机：发生<strong>事件(event)后，根据当前状态(cur_state)</strong>，决定执行的<strong>动作(action)</strong>，并设置<strong>下一个状态(nxt_state)</strong>。</p>
<p>有限状态机对象：</p>
<ul>
<li><strong>Context</strong>：上下文环境，定义客户程序需要的接口，并维护一个具体状态角色的实例，将与状态相关的操作委托给当前的 <code>ConcreteState</code>对象来处理；</li>
<li><strong>State</strong>：抽象状态,定义特定状态对应行为的接口；</li>
<li><strong>ConcreteState</strong>：具体状态，实现抽象状态定义的接口。</li>
</ul>
<p>案例：红绿灯。同时在状态机中配合了享元模式对性能进行优化（不然要多次new对象）。</p>
<p>注意：在状态机中使用享元模式，尽量不要将资源共享，不然在不同生态之间使用同一份资源可能会发生意想不到的结果。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 状态</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GreenState</span> : <span class="title">TrafficLightState</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Handle</span>(<span class="params">TrafficLight light</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;绿灯行&quot;</span>);</span><br><span class="line">        light.SetState(LightStateFactory.GetLightState&lt;YellowState&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RedState</span> : <span class="title">TrafficLightState</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Handle</span>(<span class="params">TrafficLight light</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;红灯停&quot;</span>);</span><br><span class="line">        light.SetState(LightStateFactory.GetLightState&lt;GreenState&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">YellowState</span> : <span class="title">TrafficLightState</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Handle</span>(<span class="params">TrafficLight light</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;黄灯亮了等一等&quot;</span>);</span><br><span class="line">        light.SetState(LightStateFactory.GetLightState&lt;RedState&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 状态基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">TrafficLightState</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Handle</span>(<span class="params">TrafficLight light</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 拥有状态的主体</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TrafficLight</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> TrafficLightState _currentState;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TrafficLight</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        _currentState = <span class="keyword">new</span> RedState();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Turn</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_currentState != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            _currentState.Handle(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetState</span>(<span class="params">TrafficLightState state</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _currentState = state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 状态初始化管理工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LightStateFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> IDictionary&lt;Type, TrafficLightState&gt; _lightStates</span><br><span class="line">        = <span class="keyword">new</span> Dictionary&lt;Type, TrafficLightState&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">object</span> _locker = <span class="keyword">new</span> <span class="built_in">object</span>();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TrafficLightState <span class="title">GetLightState</span>&lt;<span class="title">TLightState</span>&gt;() <span class="keyword">where</span> TLightState : TrafficLightState</span></span><br><span class="line">    &#123;</span><br><span class="line">        Type type = <span class="keyword">typeof</span>(TLightState);</span><br><span class="line">        <span class="keyword">if</span> (!_lightStates.ContainsKey(type))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">lock</span> (_locker)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (!_lightStates.ContainsKey(type))</span><br><span class="line">                &#123;</span><br><span class="line">                    TrafficLightState typeface = Activator.CreateInstance(<span class="keyword">typeof</span>(TLightState)) <span class="keyword">as</span> TrafficLightState;</span><br><span class="line">                    _lightStates.Add(type, typeface);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _lightStates[type];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        TrafficLight light = <span class="keyword">new</span> TrafficLight();</span><br><span class="line">        light.Turn();</span><br><span class="line">        light.Turn();</span><br><span class="line">        light.Turn();</span><br><span class="line">        light.Turn();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-3-游戏玩家状态机"><a href="#3-3-游戏玩家状态机" class="headerlink" title="3.3 游戏玩家状态机"></a>3.3 游戏玩家状态机</h4><blockquote>
<p>案例：定义游戏玩家的状态，比如：走路，跑步等。通过状态机进行控制。</p>
<p>注：下列代码是在Unity中执行。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 普通状态（进入、退出、更新时状态所做的事）</span></span><br><span class="line"><span class="comment">// 下列为闲置状态，其他状态同理。继承对象是超级状态。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerIdleState</span> : <span class="title">PlayerGroundState</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 构造函数，继承父类，配置状态管理机中的当前状态信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PlayerIdleState</span>(<span class="params">Player _player, PlayerStateMachine _stateMachine, <span class="built_in">string</span> _animBoolName</span>) : <span class="title">base</span>(<span class="params">_player, _stateMachine, _animBoolName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 先继承父类（状态共同要做的事）</span></span><br><span class="line">        <span class="keyword">base</span>.Enter();</span><br><span class="line">		<span class="comment">// 写自己要做的事</span></span><br><span class="line">        player.ZeroVelocity();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Exit</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">base</span>.Exit();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">base</span>.Update();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 站在墙边无法移动</span></span><br><span class="line">        <span class="keyword">if</span> (xInput == player.facingDir &amp;&amp; player.IsWallDetected())</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (xInput != <span class="number">0</span> &amp;&amp; !player.isBusy)</span><br><span class="line">            stateMachine.ChangeState(player.moveState);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 超级状态（一个大的状态）</span></span><br><span class="line"><span class="comment">// 此处为在地面的状态，在地面又可以有走、跑、跳等状态动作</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerGroundState</span> : <span class="title">PlayerState</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PlayerGroundState</span>(<span class="params">Player _player, PlayerStateMachine _stateMachine, <span class="built_in">string</span> _animBoolName</span>) : <span class="title">base</span>(<span class="params">_player, _stateMachine, _animBoolName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">base</span>.Enter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Exit</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">base</span>.Exit();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">base</span>.Update();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Input.GetKey(KeyCode.Mouse0))</span><br><span class="line">            stateMachine.ChangeState(player.primaryAttack);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!player.IsGroundDetected())</span><br><span class="line">            stateMachine.ChangeState(player.airState);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.Space) &amp;&amp; player.IsGroundDetected())</span><br><span class="line">            stateMachine.ChangeState(player.jumpState);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 状态基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerState</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">protected</span> PlayerStateMachine stateMachine;</span><br><span class="line">    <span class="keyword">protected</span> Player player;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">float</span> xInput;</span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">float</span> yInput;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> animBoolName;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PlayerState</span>(<span class="params">Player _player, PlayerStateMachine _stateMachine, <span class="built_in">string</span> _animBoolName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.player = _player;</span><br><span class="line">        <span class="keyword">this</span>.stateMachine = _stateMachine;</span><br><span class="line">        <span class="keyword">this</span>.animBoolName = _animBoolName;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 设定每个状态共同要做的时</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        player.animator.SetBool(animBoolName, <span class="literal">true</span>);</span><br><span class="line">        rb = player.rb;</span><br><span class="line">        triggerCalled = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        stateTimer -= Time.deltaTime;</span><br><span class="line"></span><br><span class="line">        xInput = Input.GetAxisRaw(<span class="string">&quot;Horizontal&quot;</span>);</span><br><span class="line">        yInput = Input.GetAxisRaw(<span class="string">&quot;Vertical&quot;</span>);</span><br><span class="line">        player.animator.SetFloat(<span class="string">&quot;yVelocity&quot;</span>, rb.velocity.y);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Exit</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        player.animator.SetBool(animBoolName, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 状态管理机</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerStateMachine</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 当前状态</span></span><br><span class="line">    <span class="keyword">public</span> PlayerState currentState &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">	<span class="comment">// 初始化状态</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">PlayerState _startState</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        currentState = _startState;</span><br><span class="line">        currentState.Enter();</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 改变状态</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ChangeState</span>(<span class="params">PlayerState _newState</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        currentState.Exit();</span><br><span class="line">        currentState = _newState;</span><br><span class="line">        currentState.Enter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 玩家（主体，拥有状态的对象）</span></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Player</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 设定状态管理机</span></span><br><span class="line">    <span class="keyword">public</span> PlayerStateMachine stateMachine &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">	<span class="comment">// 设定状态</span></span><br><span class="line">    <span class="keyword">public</span> PlayerIdleState idleState &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> PlayerMoveState moveState &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> PlayerJumpState jumpState &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 其他设置</span></span><br><span class="line">    <span class="keyword">public</span> Animator animator &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 初始化状态</span></span><br><span class="line">        stateMachine = <span class="keyword">new</span> PlayerStateMachine();</span><br><span class="line"></span><br><span class="line">        idleState = <span class="keyword">new</span> PlayerIdleState(<span class="keyword">this</span>, stateMachine, <span class="string">&quot;Idle&quot;</span>);</span><br><span class="line">        moveState = <span class="keyword">new</span> PlayerMoveState(<span class="keyword">this</span>, stateMachine, <span class="string">&quot;Move&quot;</span>);</span><br><span class="line">        jumpState = <span class="keyword">new</span> PlayerJumpState(<span class="keyword">this</span>, stateMachine, <span class="string">&quot;Jump&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 设置默认状态</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        stateMachine.Initialize(idleState);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 状态更新</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        stateMachine.currentState.Update();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="4-观察者模式"><a href="#4-观察者模式" class="headerlink" title="4 观察者模式"></a>4 观察者模式</h3><h4 id="4-1-Observer概念"><a href="#4-1-Observer概念" class="headerlink" title="4.1 Observer概念"></a>4.1 Observer概念</h4><blockquote>
<p>定义：多个对象间存在一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。</p>
<p>案例：聊天应用程序、消息推送服务、消息队列。</p>
<p>通知模式：</p>
<ul>
<li><p>推模式：由主题主动将事件消息推送给观察者，好处就是实时高效，这也是较为推荐的一种方式。</p>
</li>
<li><p>拉模式：并非所有场景都适合使用推模式，例如，某主题有非常多的观察者，但是每个观察者都只关注主题的某个或某些状态，这时使用推模式就不太合适了，因为推模式会将主题的所有状态不加区分的推送给所有观察者，对观察者而言，得到的消息就过于臃肿驳杂了。</p>
</li>
</ul>
</blockquote>
<h4 id="4-2-标准观察者模式"><a href="#4-2-标准观察者模式" class="headerlink" title="4.2 标准观察者模式"></a>4.2 标准观察者模式</h4><blockquote>
<p>观察者对象：</p>
<ul>
<li><strong>Subject</strong>：抽象主题角色，它是一个抽象类（而实际上我用的是普通类），提供了一个用于保存观察者对象的集合和增加、删除以及通知所有观察者的方法。</li>
<li><strong>ConcreteSubject</strong>：具体主题角色。</li>
<li><strong>IObserver</strong>：抽象观察者角色，它是一个接口，提供了一个更新自己的方法，当接到具体主题的更改通知时被调用。</li>
<li><strong>Concrete Observer</strong>：具体观察者角色，实现抽象观察者中定义的接口，以便在得到主题的更改通知时更新自身的状态。</li>
</ul>
<p>案例：在中学阶段有一篇课文《口技》，其中有一句“遥闻深巷中犬吠，便有妇人惊觉欠伸，其夫呓语。既而儿醒，大啼。夫亦醒。”</p>
<p>由题可知，狗叫会引发妇人惊觉、夫呓语、儿大啼，而儿大啼又会引发夫亦醒。所以在这段关系中，狗是纯被观察者，负责发出狗叫的动作。妇人和夫是纯观察者，妇人观察儿子，夫观察儿子和狗。儿子既是观察者又是被观察者，观察狗的动作的同时被父亲观察。</p>
<p>优点：</p>
<ol>
<li>主题与观察者之间的耦合低。</li>
<li>主题与观察者之间建立了一套触发机制，使得主题状态改变时能够及时通知观察者。</li>
</ol>
<p>缺点：</p>
<ol>
<li>主题与观察者之间的依赖关系并没有完全解除，而且有可能出现循环引用。</li>
<li>当观察者对象很多时，事件通知会花费很多时间，影响程序的效率。</li>
</ol>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Concrete Observer 和 ConcreteSubject</span></span><br><span class="line"><span class="comment">// 狗是被观察者，发出狗叫的动作</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Dog</span>: <span class="title">Subject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Bark</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;遥闻深巷中犬吠&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Publish(<span class="keyword">new</span> EventData &#123; Source = <span class="keyword">this</span>, EventType = <span class="string">&quot;DogBark&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 儿子既是观察者又是被观察者，儿子观察狗，同时被父亲观察</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Son</span> : <span class="title">Subject</span>, <span class="title">IObserver</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params">EventData eventData</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (eventData.EventType == <span class="string">&quot;DogBark&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Wakeup();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Wakeup</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;既而儿醒，大啼&quot;</span>);</span><br><span class="line">        Publish(<span class="keyword">new</span> EventData &#123; Source = <span class="keyword">this</span>, EventType = <span class="string">&quot;SonCry&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 妇人是观察者，观察狗</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Wife</span> : <span class="title">IObserver</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params">EventData eventData</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (eventData.EventType == <span class="string">&quot;DogBark&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Wakeup();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Wakeup</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;便有妇人惊觉欠伸&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 父亲是观察者，观察狗和儿子</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Husband</span> : <span class="title">IObserver</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DreamTalk</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;其夫呓语&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params">EventData eventData</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (eventData.EventType == <span class="string">&quot;DogBark&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            DreamTalk();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (eventData.EventType == <span class="string">&quot;SonCry&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Wakeup();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Wakeup</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;夫亦醒&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 事件类型类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EventData</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 事件源</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">object</span> Source &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">	<span class="comment">// 事件类型</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> EventType &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Subject（被观察者基类）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Subject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IList&lt;IObserver&gt; _observers = <span class="keyword">new</span> List&lt;IObserver&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddObserver</span>(<span class="params">IObserver observer</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _observers.Add(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RemoveObserver</span>(<span class="params">IObserver observer</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _observers.Remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Publish</span>(<span class="params">EventData eventData</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> observer <span class="keyword">in</span> _observers)</span><br><span class="line">        &#123;</span><br><span class="line">            observer.Update(eventData);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// IObserver（观察者基类）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IObserver</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params">EventData eventData</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Dog dog = <span class="keyword">new</span> Dog();</span><br><span class="line">        Wife wife = <span class="keyword">new</span> Wife();</span><br><span class="line">        Husband husband = <span class="keyword">new</span> Husband();</span><br><span class="line">        Son son = <span class="keyword">new</span> Son();</span><br><span class="line">        dog.AddObserver(wife);</span><br><span class="line">        dog.AddObserver(husband);</span><br><span class="line">        dog.AddObserver(son);</span><br><span class="line">        son.AddObserver(husband);</span><br><span class="line">        dog.Bark();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-事件总线"><a href="#4-3-事件总线" class="headerlink" title="4.3 事件总线"></a>4.3 事件总线</h4><blockquote>
<p>以下是观察者模式使用的两种典型场景，它们有何不同：</p>
<ul>
<li>报社订阅报纸</li>
<li>黑板上发公告</li>
</ul>
<p>回顾前面例子中的两个问题：</p>
<ul>
<li><code>dog.AddObserver(...)</code>真的合适吗？实际生活中，狗真的有这种能力吗？狗叫像是一种广播，而不需要专门的观察者。</li>
<li>因为<code>C#</code>中不支持多继承，如果<code>Dog</code>本身继承自<code>Animal</code>的基类，如果同时作为被观察者，除了用上述演进一的实现，还能如何实现？</li>
</ul>
<p>解决办法：将<code>Subject</code>做成抽象类<code>ISubject</code>，然后再设置一个<code>Subject</code>实现<code>ISubject</code>，将<code>Subject</code>作为事件总线。之后在被观察者的代码中可以以组合的方式加入<code>Subject</code>。使用时，只需要设置一个总线，初始化被观察对象时设置总线，同时向总线中加入观察者。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 观察者和被观察者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Dog</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ISubject _subject;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Dog</span>(<span class="params">ISubject subject</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>._subject = subject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Bark</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;遥闻深巷中犬吠&quot;</span>);</span><br><span class="line"></span><br><span class="line">        _subject.Publish(<span class="keyword">new</span> EventData &#123; Source = <span class="keyword">this</span>, EventType = <span class="string">&quot;DogBark&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Son</span>: <span class="title">IObserver</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ISubject _subject;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Son</span>(<span class="params">ISubject subject</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>._subject = subject;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params">EventData eventData</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (eventData.EventType == <span class="string">&quot;DogBark&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Wakeup();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Wakeup</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;既而儿醒，大啼&quot;</span>);</span><br><span class="line">        _subject.Publish(<span class="keyword">new</span> EventData &#123; Source = <span class="keyword">this</span>, EventType = <span class="string">&quot;SonCry&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Husband</span>: <span class="title">IObserver</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DreamTalk</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;其夫呓语&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params">EventData eventData</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (eventData.EventType == <span class="string">&quot;DogBark&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            DreamTalk();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (eventData.EventType == <span class="string">&quot;SonCry&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Wakeup();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Wakeup</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;夫亦醒&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Wife</span>: <span class="title">IObserver</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params">EventData eventData</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (eventData.EventType == <span class="string">&quot;DogBark&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Wakeup();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Wakeup</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;便有妇人惊觉欠伸&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 事件类型类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EventData</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 事件源</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">object</span> Source &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">	<span class="comment">// 事件类型</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> EventType &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 事件总线（实现被观察者基类）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Subject</span>: <span class="title">ISubject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IList&lt;IObserver&gt; _observers = <span class="keyword">new</span> List&lt;IObserver&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddObserver</span>(<span class="params">IObserver observer</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _observers.Add(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RemoveObserver</span>(<span class="params">IObserver observer</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _observers.Remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Publish</span>(<span class="params">EventData eventData</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> observer <span class="keyword">in</span> _observers)</span><br><span class="line">        &#123;</span><br><span class="line">            observer.Update(eventData);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 事件总线基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISubject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">AddObserver</span>(<span class="params">IObserver observer</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">RemoveObserver</span>(<span class="params">IObserver observer</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Publish</span>(<span class="params">EventData eventData</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察者基类 </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IObserver</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params">EventData eventData</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">   		<span class="comment">// 初始化总线</span></span><br><span class="line">        ISubject subject = <span class="keyword">new</span> Subject();</span><br><span class="line">        <span class="comment">// 被观察对象设置总线</span></span><br><span class="line">        Dog dog = <span class="keyword">new</span> Dog(subject);</span><br><span class="line">        Wife wife = <span class="keyword">new</span> Wife();</span><br><span class="line">        Husband husband = <span class="keyword">new</span> Husband();</span><br><span class="line">        <span class="comment">// 被观察对象设置总线</span></span><br><span class="line">        Son son = <span class="keyword">new</span> Son(subject);</span><br><span class="line">		<span class="comment">// 向总线中加上观察者</span></span><br><span class="line">        subject.AddObserver(wife);</span><br><span class="line">        subject.AddObserver(husband);</span><br><span class="line">        subject.AddObserver(son);</span><br><span class="line"></span><br><span class="line">        dog.Bark();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-4-消息队列"><a href="#4-4-消息队列" class="headerlink" title="4.4 消息队列"></a>4.4 消息队列</h4><blockquote>
<p>思考：如果主题和观察者分属两个不同的系统该怎么办？</p>
<p>利用Broker代理：</p>
<ol>
<li>一个<code>Queue&lt;EventData&gt;</code>类型的队列，用于存放事件消息。</li>
<li>一组注册和注销观察者的方法。</li>
<li>一个接收来自事件发布者的事件消息的方法。</li>
<li>最后就是事件消息的通知机制，这里用的是定时轮询的方式，实际应用中肯定不会这么简单。</li>
</ol>
<p>演进过程：</p>
<ol>
<li>第一阶段主题与观察者之间的耦合低，但并没有完全解耦，这种情况主要应用在类似报纸订阅的场景。</li>
<li>第二阶段在主题与观察者之间加了一条总线，使得主题与观察者完全解耦，这种情况主要运用在类似黑板广播消息的场景。</li>
<li>第三阶段在总线与观察者之间加了一个代理，使得存在于不同系统之间的主题与观察者也能够解耦并且正常通信。</li>
</ol>
<p>.Net中的应用：</p>
<ol>
<li>委托(<code>delegate</code>)和事件(<code>event</code>)。</li>
<li><code>.Net</code>中提供了一组泛型接口<code>IObserver&lt;T&gt;</code>和<code>IObservable&lt;T&gt;</code>可用于实现事件通知机制。</li>
</ol>
</blockquote>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 观察者和被观察者代码不变，IObserver代码不变</span></span><br><span class="line">...;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Broker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Broker</span></span><br><span class="line">&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Lazy&lt;Broker&gt; _instance</span><br><span class="line">        = <span class="keyword">new</span> Lazy&lt;Broker&gt;(() =&gt; <span class="keyword">new</span> Broker());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> Queue&lt;EventData&gt; _eventDatas = <span class="keyword">new</span> Queue&lt;EventData&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IList&lt;IObserver&gt; _observers = <span class="keyword">new</span> List&lt;IObserver&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> Thread _thread;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Broker</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 开一个线程，模拟永不停息的轮询器</span></span><br><span class="line">        _thread = <span class="keyword">new</span> Thread(Notify);</span><br><span class="line">        _thread.Start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Broker Instance</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span>&#123; <span class="keyword">return</span> _instance.Value; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddObserver</span>(<span class="params">IObserver observer</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _observers.Add(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RemoveObserver</span>(<span class="params">IObserver observer</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _observers.Remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 事件轮询</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Notify</span>(<span class="params"><span class="built_in">object</span>? state</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_eventDatas.Count &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> eventData = _eventDatas.Dequeue();</span><br><span class="line">                <span class="keyword">foreach</span> (<span class="keyword">var</span> observer <span class="keyword">in</span> _observers)</span><br><span class="line">                &#123;</span><br><span class="line">                    observer.Update(eventData);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Thread.Sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Enqueue</span>(<span class="params">EventData eventData</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _eventDatas.Enqueue(eventData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 事件总线</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Subject</span>: <span class="title">ISubject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Publish</span>(<span class="params">EventData eventData</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Broker.Instance.Enqueue(eventData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 事件总线抽象类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISubject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Publish</span>(<span class="params">EventData eventData</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        ISubject subject = <span class="keyword">new</span> Subject();</span><br><span class="line">        Dog dog = <span class="keyword">new</span> Dog(subject);</span><br><span class="line">        Wife wife = <span class="keyword">new</span> Wife();</span><br><span class="line">        Husband husband = <span class="keyword">new</span> Husband();</span><br><span class="line">        Son son = <span class="keyword">new</span> Son(subject);</span><br><span class="line">        <span class="comment">// 注册到代理中而非总线中</span></span><br><span class="line">        Broker.Instance.AddObserver(wife);</span><br><span class="line">        Broker.Instance.AddObserver(husband);</span><br><span class="line">        Broker.Instance.AddObserver(son);</span><br><span class="line"></span><br><span class="line">        dog.Bark();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-责任链模式"><a href="#5-责任链模式" class="headerlink" title="5 责任链模式"></a>5 责任链模式</h3><h4 id="5-1-ChainOfResponsibility概念"><a href="#5-1-ChainOfResponsibility概念" class="headerlink" title="5.1 ChainOfResponsibility概念"></a>5.1 ChainOfResponsibility概念</h4><blockquote>
<p>定义：多个对象都有机会处理某个请求，将这些对象连成一条链，并沿着这条链传递该请求，直到有对象处理它为止。</p>
<p>案例：用程序实现一个请假流程，根据请假天数不同，需要各级领导审批，例如，如果请假时长不超过1天，则直接团队负责人申请即可，超过1天不超过3天则需要项目经理审批通过才行，而超过3天不超过7天则需要CTO审批等等。</p>
<p>优点：请求和处理分离，请求者可以不用知道是谁处理的，处 理者可以不用知道请求的全貌，两者解耦，提高系统的灵活性；</p>
<p>缺点：性能不高；调试不很方便。</p>
</blockquote>
<h3 id="后面的作者鸽了"><a href="#后面的作者鸽了" class="headerlink" title="==后面的作者鸽了=="></a>==后面的作者鸽了==</h3><h3 id="6-迭代器模式"><a href="#6-迭代器模式" class="headerlink" title="6 迭代器模式"></a>6 迭代器模式</h3><h4 id="6-1-Iterator概念"><a href="#6-1-Iterator概念" class="headerlink" title="6.1 Iterator概念"></a>6.1 Iterator概念</h4><h3 id="7-命令模式"><a href="#7-命令模式" class="headerlink" title="7 命令模式"></a>7 命令模式</h3><h4 id="7-1-Command概念"><a href="#7-1-Command概念" class="headerlink" title="7.1 Command概念"></a>7.1 Command概念</h4><h3 id="8-备忘录模式"><a href="#8-备忘录模式" class="headerlink" title="8 备忘录模式"></a>8 备忘录模式</h3><h4 id="8-1-Memento概念"><a href="#8-1-Memento概念" class="headerlink" title="8.1 Memento概念"></a>8.1 Memento概念</h4><h3 id="9-访问者模式"><a href="#9-访问者模式" class="headerlink" title="9 访问者模式"></a>9 访问者模式</h3><h4 id="9-1-Visitor概念"><a href="#9-1-Visitor概念" class="headerlink" title="9.1 Visitor概念"></a>9.1 Visitor概念</h4><h3 id="10-中介者模式"><a href="#10-中介者模式" class="headerlink" title="10 中介者模式"></a>10 中介者模式</h3><h4 id="10-1-Mediator概念"><a href="#10-1-Mediator概念" class="headerlink" title="10.1 Mediator概念"></a>10.1 Mediator概念</h4><h3 id="11-解释器模式"><a href="#11-解释器模式" class="headerlink" title="11 解释器模式"></a>11 解释器模式</h3><h4 id="11-1-Interpreter概念"><a href="#11-1-Interpreter概念" class="headerlink" title="11.1 Interpreter概念"></a>11.1 Interpreter概念</h4><hr>
<h2 id="五、其他"><a href="#五、其他" class="headerlink" title="五、其他"></a>五、其他</h2><h3 id="1-反模式"><a href="#1-反模式" class="headerlink" title="1 反模式"></a>1 反模式</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/374019475">设计模式终章之反模式 - 知乎 (zhihu.com)</a></p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://Magialeaf.github.io">Maigaleaf</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://magialeaf.github.io/posts/364ea8cc.html">http://magialeaf.github.io/posts/364ea8cc.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://Magialeaf.github.io" target="_blank">Magialeaf的小窝</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%A6%82%E8%BF%B0/">概述</a><a class="post-meta__tags" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></div><div class="post_share"><div class="social-share" data-image="/img/default_cover_9.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/251c2987.html" title="C++游戏"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_5.png" onerror="onerror=null;src='/img/error.png'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">C++游戏</div></div></a></div><div class="next-post pull-right"><a href="/posts/d7e8ef81.html" title="Typescript"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_15.png" onerror="onerror=null;src='/img/error.png'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Typescript</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/c386cf1b.html" title="Python爬虫"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_5.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2024-03-26</div><div class="title">Python爬虫</div></div></a></div><div><a href="/posts/dd9c034b.html" title="网站配置记录"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_15.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-09-04</div><div class="title">网站配置记录</div></div></a></div><div><a href="/posts/e3bc6d90.html" title="密码学工具知识"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_5.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2024-01-18</div><div class="title">密码学工具知识</div></div></a></div><div><a href="/posts/7302411.html" title="密码学密码知识"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_5.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-12-06</div><div class="title">密码学密码知识</div></div></a></div><div><a href="/posts/30ce291f.html" title="密码学理论知识"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_5.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-12-06</div><div class="title">密码学理论知识</div></div></a></div><div><a href="/posts/fbb199ac.html" title="密码学编码知识"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_12.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-12-06</div><div class="title">密码学编码知识</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Maigaleaf</div><div class="author-info__description">欢迎来到我的小窝！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">79</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">59</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Magialeaf"><i class="fab fa-github"></i><span>前往我的仓库</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://res.abeim.cn/api/qq?qq=1871154309" target="_blank" title="QQ"><i class="fa-brands fa-qq"></i></a><a class="social-icon" href="https://space.bilibili.com/45054712" target="_blank" title="bilibili"><i class="fa-brands fa-bilibili"></i></a><a class="social-icon" href="https://blog.csdn.net/qq_51591267" target="_blank" title="CSDN"><i class="fa-solid fa-c" style="color: ;"></i></a><a class="social-icon" href="https://leetcode.cn/u/heuristic-chandrasekhardtz/" target="_blank" title="leetcode"><i class="fas fa-code"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><card_announce_top>当前网站版本为V1.03<br /></card_announce_top> <card_announce_content> 1.网站目前文章多为思维导图，类似随笔，记录比较简略。<br /> 2.之后会完善一些未写完的文章，以及写一些详细的文章。<br /> 3.找文章推荐在分类中按<a href="/categories/" class="strong">分类</a>寻找。 <br /> 4.每日更新以及网站更新可以在<a href="/about/" class="strong">关于</a>中查看。<br /><br /> </card_announce_content> <card_announce_tip> 文章链接为紫色，链接前缀如下：<br /> &nbsp; 1.无前缀（百科或其他作者的链接）<br /> &nbsp; 2.author::（文章中引用了许多该作者的内容）<br /> &nbsp; 3.official::（官网链接）<br /> &nbsp; 4.text::（我的其他文本）<br /> &nbsp; 5.my::（我的库或其他链接）<br /> </card_announce_tip></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text">设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%9F%BA%E7%A1%80"><span class="toc-text">一、设计模式基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1"><span class="toc-text">1 面向对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text">2 设计模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%B8%83%E5%A4%A7%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-text">3 七大设计原则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BA%E5%9E%8B"><span class="toc-text">二、创建型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-text">1 工厂模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-Factory%E6%A6%82%E5%BF%B5"><span class="toc-text">1.1 Factory概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-text">1.2 简单工厂模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-text">1.3 工厂方法模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-text">1.4 抽象工厂模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">2 单例模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-Singleton%E6%A6%82%E5%BF%B5"><span class="toc-text">2.1 Singleton概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E9%9D%99%E6%80%81%E7%B1%BB%E5%AE%9E%E7%8E%B0"><span class="toc-text">2.2 静态类实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%86%85%E9%83%A8%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">2.3 内部初始化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E8%BF%87%E6%B8%A1%E7%B1%BB"><span class="toc-text">2.4 过渡类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-%E5%8F%8C%E6%A3%80%E9%94%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">2.5 双检锁实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-%E6%87%92%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%BC%8F"><span class="toc-text">2.6 懒加载模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-7-%E6%87%92%E5%8A%A0%E8%BD%BD%E6%B3%9B%E5%9E%8B"><span class="toc-text">2.7 懒加载泛型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-8-%E5%8D%95%E4%BE%8B%E6%A1%88%E4%BE%8B"><span class="toc-text">2.8 单例案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%BB%BA%E7%AD%91%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">3 建筑者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-Builder%E6%A6%82%E5%BF%B5"><span class="toc-text">3.1 Builder概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E6%9C%80%E7%AE%80%E5%8D%95%E5%BB%BA%E7%AD%91%E8%80%85"><span class="toc-text">3.2 最简单建筑者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E5%BB%BA%E7%AD%91"><span class="toc-text">3.3 工厂方法建筑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E6%A0%87%E5%87%86%E5%BB%BA%E7%AD%91%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">3.4 标准建筑者模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-%E4%BC%98%E5%8C%96%E5%BB%BA%E7%AD%91%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">3.5 优化建筑者模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%8E%9F%E5%BD%A2%E6%A8%A1%E5%BC%8F"><span class="toc-text">4 原形模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-Prototype%E6%A6%82%E5%BF%B5"><span class="toc-text">4.1 Prototype概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E6%89%8B%E5%8A%A8%E5%85%8B%E9%9A%86"><span class="toc-text">4.2 手动克隆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E6%B5%85%E6%8B%B7%E8%B4%9D%E5%85%8B%E9%9A%86"><span class="toc-text">4.3 浅拷贝克隆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-%E5%BA%8F%E5%88%97%E5%8C%96%E5%85%8B%E9%9A%86"><span class="toc-text">4.4 序列化克隆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-ICloneable%E5%85%8B%E9%9A%86"><span class="toc-text">4.5 ICloneable克隆</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%BB%93%E6%9E%84%E5%9E%8B"><span class="toc-text">三、结构型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">1 适配器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-Adapter%E6%A6%82%E5%BF%B5"><span class="toc-text">1.1 Adapter概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E7%94%B5%E8%84%91%E9%80%82%E9%85%8D%E5%99%A8%E6%A1%88%E4%BE%8B"><span class="toc-text">1.2 电脑适配器案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc-text">2 代理模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-Proxy%E6%A6%82%E5%BF%B5"><span class="toc-text">2.1 Proxy概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E6%A1%88%E4%BE%8B"><span class="toc-text">2.2 图片加载案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F"><span class="toc-text">3 外观模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-Facade%E6%A6%82%E5%BF%B5"><span class="toc-text">3.1 Facade概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%9B%9E%E5%AE%B6%E6%A1%88%E4%BE%8B"><span class="toc-text">3.2 回家案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">4 装饰器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-Decorator%E6%A6%82%E5%BF%B5"><span class="toc-text">4.1 Decorator概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E5%A5%B6%E8%8C%B6%E9%9D%9E%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A1%88%E4%BE%8B"><span class="toc-text">4.2  奶茶非装饰器案例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E5%A5%B6%E8%8C%B6%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A1%88%E4%BE%8B"><span class="toc-text">4.3 奶茶装饰器案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F"><span class="toc-text">5 桥接模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-Bridge%E6%A6%82%E5%BF%B5"><span class="toc-text">5.1 Bridge概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E5%A5%B6%E8%8C%B6%E6%A1%A5%E6%8E%A5%E6%A1%88%E4%BE%8B"><span class="toc-text">5.2 奶茶桥接案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="toc-text">6 组合模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-Composite%E6%A6%82%E5%BF%B5"><span class="toc-text">6.1 Composite概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-%E9%80%8F%E6%98%8E%E6%A8%A1%E5%BC%8F"><span class="toc-text">6.2 透明模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-%E5%AE%89%E5%85%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">6.3 安全模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F"><span class="toc-text">7 享元模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-Flyweight%E6%A6%82%E5%BF%B5"><span class="toc-text">7.1 Flyweight概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-%E5%86%85%E9%83%A8%E5%88%9B%E5%BB%BA%E5%9E%8B"><span class="toc-text">7.2 内部创建型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-%E5%A4%96%E9%83%A8%E5%88%9B%E5%BB%BA%E5%9E%8B"><span class="toc-text">7.3 外部创建型</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E8%A1%8C%E4%B8%BA%E5%9E%8B"><span class="toc-text">四、行为型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A8%A1%E7%89%88%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-text">1 模版方法模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-TemplateMethod%E6%A6%82%E5%BF%B5"><span class="toc-text">1.1 TemplateMethod概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E5%A4%A7%E8%B1%A1%E6%94%BE%E5%86%B0%E7%AE%B1%E6%A1%88%E4%BE%8B"><span class="toc-text">1.2 大象放冰箱案例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E9%95%BF%E9%A2%88%E9%B9%BF%E6%94%BE%E5%86%B0%E7%AE%B1%E6%A1%88%E4%BE%8B"><span class="toc-text">1.3 长颈鹿放冰箱案例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%87%AA%E5%AE%9A%E4%B9%89"><span class="toc-text">1.4 客户端自定义</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="toc-text">2 策略模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-Strategy%E6%A6%82%E5%BF%B5"><span class="toc-text">2.1 Strategy概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E7%94%BB%E6%9D%BF%E6%A1%88%E4%BE%8B"><span class="toc-text">2.2 画板案例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E4%BC%98%E5%8C%96"><span class="toc-text">2.3 简单工厂优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F"><span class="toc-text">3 状态模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-State%E6%A6%82%E5%BF%B5"><span class="toc-text">3.1 State概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="toc-text">3.2 有限状态机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E6%B8%B8%E6%88%8F%E7%8E%A9%E5%AE%B6%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="toc-text">3.3 游戏玩家状态机</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">4 观察者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-Observer%E6%A6%82%E5%BF%B5"><span class="toc-text">4.1 Observer概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E6%A0%87%E5%87%86%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">4.2 标准观察者模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF"><span class="toc-text">4.3 事件总线</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="toc-text">4.4 消息队列</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F"><span class="toc-text">5 责任链模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-ChainOfResponsibility%E6%A6%82%E5%BF%B5"><span class="toc-text">5.1 ChainOfResponsibility概念</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E9%9D%A2%E7%9A%84%E4%BD%9C%E8%80%85%E9%B8%BD%E4%BA%86"><span class="toc-text">&#x3D;&#x3D;后面的作者鸽了&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">6 迭代器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-Iterator%E6%A6%82%E5%BF%B5"><span class="toc-text">6.1 Iterator概念</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-text">7 命令模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-Command%E6%A6%82%E5%BF%B5"><span class="toc-text">7.1 Command概念</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F"><span class="toc-text">8 备忘录模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-Memento%E6%A6%82%E5%BF%B5"><span class="toc-text">8.1 Memento概念</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">9 访问者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-Visitor%E6%A6%82%E5%BF%B5"><span class="toc-text">9.1 Visitor概念</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">10 中介者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-Mediator%E6%A6%82%E5%BF%B5"><span class="toc-text">10.1 Mediator概念</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">11 解释器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-1-Interpreter%E6%A6%82%E5%BF%B5"><span class="toc-text">11.1 Interpreter概念</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%85%B6%E4%BB%96"><span class="toc-text">五、其他</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8F%8D%E6%A8%A1%E5%BC%8F"><span class="toc-text">1 反模式</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/c24675b4.html" title="MySQL"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_4.png" onerror="this.onerror=null;this.src='/img/error.png'" alt="MySQL"/></a><div class="content"><a class="title" href="/posts/c24675b4.html" title="MySQL">MySQL</a><time datetime="2024-04-22T04:00:00.000Z" title="发表于 2024-04-22 12:00:00">2024-04-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/65b69107.html" title="Nginx"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_3.png" onerror="this.onerror=null;this.src='/img/error.png'" alt="Nginx"/></a><div class="content"><a class="title" href="/posts/65b69107.html" title="Nginx">Nginx</a><time datetime="2024-03-29T04:00:00.000Z" title="发表于 2024-03-29 12:00:00">2024-03-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/19bd9e59.html" title="selenium模块"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_6.png" onerror="this.onerror=null;this.src='/img/error.png'" alt="selenium模块"/></a><div class="content"><a class="title" href="/posts/19bd9e59.html" title="selenium模块">selenium模块</a><time datetime="2024-03-26T04:00:00.000Z" title="发表于 2024-03-26 12:00:00">2024-03-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/c386cf1b.html" title="Scrapy"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_11.png" onerror="this.onerror=null;this.src='/img/error.png'" alt="Scrapy"/></a><div class="content"><a class="title" href="/posts/c386cf1b.html" title="Scrapy">Scrapy</a><time datetime="2024-03-26T04:00:00.000Z" title="发表于 2024-03-26 12:00:00">2024-03-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/bce7e83e.html" title="Python高级"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_14.png" onerror="this.onerror=null;this.src='/img/error.png'" alt="Python高级"/></a><div class="content"><a class="title" href="/posts/bce7e83e.html" title="Python高级">Python高级</a><time datetime="2024-03-23T04:00:00.000Z" title="发表于 2024-03-23 12:00:00">2024-03-23</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/default_cover_9.png')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By Maigaleaf</div><div class="footer_custom_text">版本V1.03</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><!-- 按钮阅读进度--><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><!-- 至底--><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer data-pjax src="/js/readPercent.js"></script><script defer src="/js/copy.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="40" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v6.3.0" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v4.8.5" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="/js/runtime.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/54924480.html" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_7.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-05-21</span><a class="blog-slider__title" href="posts/54924480.html" alt="">Web渗透</a><div class="blog-slider__text">Web渗透概述</div><a class="blog-slider__button" href="posts/54924480.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/3e112b55.html" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_8.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-11-15</span><a class="blog-slider__title" href="posts/3e112b55.html" alt="">Web语言漏洞</a><div class="blog-slider__text">Web渗透概述</div><a class="blog-slider__button" href="posts/3e112b55.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/4b0178e0.html" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_14.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-05-21</span><a class="blog-slider__title" href="posts/4b0178e0.html" alt="">数据结构与算法</a><div class="blog-slider__text">数据结构与算法概述</div><a class="blog-slider__button" href="posts/4b0178e0.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/c036635b.html" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_10.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-05-21</span><a class="blog-slider__title" href="posts/c036635b.html" alt="">PHP</a><div class="blog-slider__text">PHP概述</div><a class="blog-slider__button" href="posts/c036635b.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/b81b1ca5.html" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_12.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-05-21</span><a class="blog-slider__title" href="posts/b81b1ca5.html" alt="">masm32汇编</a><div class="blog-slider__text">masm32汇编概述</div><a class="blog-slider__button" href="posts/b81b1ca5.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/cc1b9611.html" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_14.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-05-21</span><a class="blog-slider__title" href="posts/cc1b9611.html" alt="">JavaScript</a><div class="blog-slider__text">JavaScript概述</div><a class="blog-slider__button" href="posts/cc1b9611.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/a378bd8e.html" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_3.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-05-21</span><a class="blog-slider__title" href="posts/a378bd8e.html" alt="">Python</a><div class="blog-slider__text">Python使用概述</div><a class="blog-slider__button" href="posts/a378bd8e.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/cf1dc19e.html" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default_cover_7.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-05-21</span><a class="blog-slider__title" href="posts/cf1dc19e.html" alt="">Unity脚本</a><div class="blog-slider__text">Unity脚本程序概述</div><a class="blog-slider__button" href="posts/cf1dc19e.html" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__fadeIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__fadeInRight');
    arr[i].setAttribute('data-wow-duration', '1.25s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --></body></html>